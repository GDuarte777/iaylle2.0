import{c as Ze,j as l,x as hr,B as br,H as u,a8 as pe,O as Q,I as f,o as e,a9 as vr,aa as wr,X as xe,N as U,ab as Y}from"./index-BSbx0JO7.js";import{G as ge}from"./GlassCard-VIvyi7x2.js";import{D as jr,a as yr,E as Nr,b as _r,c as kr,d as Ke,e as F}from"./dropdown-menu-D-FqttMG.js";import{D as he,a as be,c as ve,b as we,e as je}from"./dialog-C88qaMGg.js";import{C as Z}from"./checkbox-DgX4dwFR.js";import{S as ye}from"./switch-DA0YKYd7.js";import{I as Je}from"./input-DQGwEGmE.js";import{L as Ne}from"./label-BW0ItMpA.js";import{A as Sr,a as Cr,b as Ar,c as Er,d as Dr,e as Tr,f as Pr,g as Rr}from"./alert-dialog-Di4MvaR_.js";import{S as Xe}from"./search-DPd-n7Mp.js";import{S as Qe}from"./shield-alert-CntGOgKP.js";import{L as Or}from"./loader-circle-FaZJHInu.js";import{C as Ur}from"./check-BbYG4ixu.js";import{P as Ye}from"./plus-fQ5sqYr7.js";import"./index-CJ5TKr5o.js";import"./index-BAL7-AhQ.js";import"./index-CBUzlWaP.js";import"./index-CjQuBds1.js";import"./index-BQjkmplr.js";import"./index-DiCYkEsm.js";import"./button-BPilKZxs.js";const $r=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],qr=Ze("ban",$r);const Lr=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Ir=Ze("log-in",Lr),B=[{id:"/dashboard",label:"Dashboard (Visão Geral)"},{id:"/dashboard/gamification",label:"Gamificação"},{id:"/dashboard/sorteios",label:"Sorteios"},{id:"/dashboard/roleta",label:"Roleta Criativa"},{id:"/dashboard/whatsapp-link",label:"Gerador WhatsApp"},{id:"/dashboard/workflows",label:"Mapa Mental"},{id:"/dashboard/workflow",label:"Mapa Mental (Editor)"},{id:"/dashboard/link-bio",label:"Link na Bio"},{id:"/dashboard/settings",label:"Perfil"},{id:"/dashboard/ranking",label:"Ranking Global"}];function ls(){const[$,er]=l.useState(""),[ee,rr]=l.useState(""),{plans:re,fetchPlans:_e}=hr(),{user:v}=br(),[se,q]=l.useState([]),[sr,ke]=l.useState(!0),[c,A]=l.useState(null),[h,G]=l.useState(null),[L,Se]=l.useState(!1),[w,y]=l.useState({add:[],remove:[]}),[S,E]=l.useState({}),[I,Ce]=l.useState({}),[Mr,Ae]=l.useState(!1),[ae,D]=l.useState("idle"),[ar,T]=l.useState(""),[tr,te]=l.useState(!1),[or,nr]=l.useState(""),[ir,lr]=l.useState(""),z=l.useRef(null),[Ee,oe]=l.useState([]),[ne,ie]=l.useState(null),[C,V]=l.useState(null),[P,H]=l.useState({add:[],remove:[]}),[De,Te]=l.useState(!1),W=l.useRef(w),K=l.useRef(S),R=l.useRef(!1),J=l.useRef(!1),p=l.useRef(null),Pe=l.useRef(0),le=l.useRef(null),de=l.useRef(!1),ce=l.useRef(()=>{});l.useEffect(()=>{de.current=!1,R.current=!1,J.current=!1,le.current=null,D("idle"),T(""),p.current&&(window.clearTimeout(p.current),p.current=null)},[c?.id]),l.useEffect(()=>{W.current=w},[w]),l.useEffect(()=>{K.current=S},[S]);const Re=l.useCallback(r=>{z.current=r.onConfirm,nr(r.title),lr(r.description),te(!0)},[]),Oe=l.useCallback(r=>{R.current=!0,D("dirty"),T("Alterações pendentes"),p.current&&(window.clearTimeout(p.current),p.current=null);const s=r?.immediate?0:350;p.current=window.setTimeout(()=>{p.current=null,ce.current({silentSuccess:r?.silentSuccess??!1})},s)},[]),N=l.useCallback(r=>{if(L)return;const s=()=>{r(),Oe()};if(de.current){s();return}Re({title:"Salvar permissões em tempo real?",description:"As alterações serão aplicadas imediatamente e salvas automaticamente (sem botão Salvar). Você poderá alternar permissões rapidamente.",onConfirm:()=>{de.current=!0,s()}})},[L,Oe,Re]),Ue=l.useCallback(r=>{const s=a=>Array.from(new Set(a.filter(t=>typeof t=="string"&&t.trim().length>0)));return{add:s(r.add),remove:s(r.remove)}},[]),me=l.useCallback(r=>{const s=r.split(":")[0]?.trim()??r;return s==="not_authenticated"||s==="missing_auth"||s==="invalid_auth"?"Sessão expirada. Faça login novamente.":s==="forbidden"?"Apenas administradores podem alterar permissões.":s==="overlapping_permissions"||s==="allowed_pages_add_remove_overlap"?"Uma página não pode estar em adicionar e remover ao mesmo tempo.":s==="invalid_dashboard_path"?"Caminho inválido. Use apenas páginas do dashboard.":s==="invalid_tool_overrides"?"Configuração de ferramentas inválida.":s==="missing_body"||s==="invalid_json"||s==="invalid_body"?"Requisição inválida. Tente novamente.":s==="missing_user_id"?"Usuário não identificado.":s==="missing_team_id"?"Equipe não identificada.":s==="user_not_found"?"Usuário não encontrado.":s==="profile_update_failed"?"Não foi possível salvar as permissões agora.":s==="rate_limited"?"Muitas tentativas. Aguarde um momento.":s==="rate_limit_unavailable"?"Serviço temporariamente indisponível. Tente novamente.":s==="internal_error"?"Erro interno ao salvar permissões. Tente novamente.":r},[]),_=l.useCallback(r=>{if(r instanceof Error)return r.message;if(typeof r=="string")return r;if(typeof r=="object"&&r!==null){const s=r,a=typeof s.message=="string"?s.message:"",t=typeof s.details=="string"?s.details:"",o=typeof s.hint=="string"?s.hint:"",n=[a,t,o].map(i=>i.trim()).filter(Boolean);if(n.length>0)return n.join(" - ");try{return JSON.stringify(r)}catch{return"Erro desconhecido"}}return String(r)},[]),$e=l.useCallback(async r=>{const s=_(r),a=typeof r=="object"&&r!==null&&"context"in r?r.context:null;if(a&&typeof a.text=="function")try{const t=await a.text();if(t){let o=null;try{o=JSON.parse(t)}catch{o=null}if(o&&typeof o=="object"){const n=o.error,i=o.details;if(typeof n=="string"&&n.trim().length>0)return typeof i=="string"&&i.trim().length>0?`${n}: ${i}`:n}return t}}catch{return s}return s},[_]),qe=l.useCallback(async r=>{if(!c?.id||!v||v.role!=="admin"||L||!r?.force&&!R.current||J.current)return;const s=Ue(W.current),a=Array.from(new Set(s.add)),t=Array.from(new Set(s.remove));if(a.find(i=>t.includes(i))){D("error"),T("Conflito: uma página está em adicionar e remover"),u.error("Erro ao salvar permissões",{description:"Uma página não pode estar em adicionar e remover ao mesmo tempo."});return}const n=pe(K.current);J.current=!0,R.current=!1,Ae(!0),D("saving"),T("Salvando...");try{if(!await Q())throw new Error("not_authenticated");const{data:d,error:m}=await f.functions.invoke("admin-access-overrides",{body:{action:"set_user_overrides",userId:c.id,overrides:{allowedPagesAdd:a,allowedPagesRemove:t,toolsDisabledByPage:n}}});if(m)throw new Error(await $e(m));if(d&&typeof d=="object"&&"error"in d&&d.error){const b=String(d.error),k=d.details;throw typeof k=="string"&&k.trim().length>0?new Error(`${b}: ${k}`):new Error(b)}const x=d?.profile;if(x){const b={add:Array.from(new Set(x.allowed_pages_add??[])),remove:Array.from(new Set(x.allowed_pages_remove??[]))};W.current=b,y(b);const k=x?.dashboard_config?.access_overrides?.tools_disabled,O=pe(k);K.current=O,E(O),le.current={add:b.add,remove:b.remove,tools:O}}D("saved"),T("Salvo");const j=Date.now();!r?.silentSuccess&&j-Pe.current>3e3&&(Pe.current=j,u.success("Permissões atualizadas"))}catch(i){const d=_(i);D("error"),T("Erro ao salvar"),u.error("Erro ao salvar permissões",{description:me(d)});const m=le.current;m?(W.current={add:m.add,remove:m.remove},K.current=m.tools,y({add:m.add,remove:m.remove}),E(m.tools)):R.current=!0}finally{J.current=!1,Ae(!1),R.current&&(p.current&&(window.clearTimeout(p.current),p.current=null),p.current=window.setTimeout(()=>{p.current=null,ce.current({silentSuccess:!0})},0))}},[v,L,me,_,$e,Ue,c?.id]);l.useEffect(()=>{ce.current=r=>{qe(r)}},[qe]),l.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=null)},[]);const ue=l.useCallback(async r=>{ke(!0);try{const{data:s,error:a}=await f.rpc("get_admin_users",{p_search:r,p_limit:200,p_offset:0});if(a)throw a;const t=Array.isArray(s)?s:[];q(t.map(o=>({id:String(o.id),name:String(o.full_name??"Sem nome"),email:String(o.email??""),role:String(o.role??"member"),status:String(o.status??"active"),plan:String(o.plan_name??"Free")})))}catch(s){const a=_(s);u.error(`Erro ao carregar usuários: ${a}`),q([])}finally{ke(!1)}},[_]);l.useEffect(()=>{_e()},[_e]),l.useEffect(()=>{const r=window.setTimeout(()=>{rr($)},250);return()=>window.clearTimeout(r)},[$]),l.useEffect(()=>{ue(ee)},[ee,ue]),l.useEffect(()=>{if(!c?.id)return;let r=!1;Se(!0);const s=t=>Array.from(new Set(t.filter(o=>typeof o=="string"&&o.trim().length>0)));return(async()=>{const{data:t,error:o}=await f.from("profiles").select("id, allowed_pages_add, allowed_pages_remove, dashboard_config").eq("id",c.id).maybeSingle();if(r)return;if(o)throw o;y({add:s(t?.allowed_pages_add??[]),remove:s(t?.allowed_pages_remove??[])});const n=t?.dashboard_config?.access_overrides?.tools_disabled;E(pe(n));const{data:i,error:d}=await f.from("subscriptions").select("status, plan:plans(name, allowed_pages)").eq("user_id",c.id).in("status",["active","trialing","past_due"]).maybeSingle();if(r)return;if(d)throw d;const m=i?.plan?.name?String(i.plan.name):null,x=i?.plan?.allowed_pages,j=Array.isArray(x)?s(x):null;if(m)ie({name:m,allowedPages:j});else{const g=re.find(M=>M.name==="Free"||M.price===0);ie({name:g?.name??"Free",allowedPages:g?.allowedPages??null})}const{data:b,error:k}=await f.from("team_members").select("team_id, role, team:teams(id, name)").eq("user_id",c.id);if(r)return;if(k)throw k;const O=(b??[]).map(g=>({teamId:String(g.team_id),name:String(g.team?.name??g.team_id),memberRole:String(g.role??"member")})),He=s(O.map(g=>g.teamId)),We={};if(He.length>0){const{data:g,error:M}=await f.from("team_access_overrides").select("team_id, allowed_pages_add, allowed_pages_remove").in("team_id",He);if(r)return;if(M)throw M;(g??[]).forEach(fe=>{We[String(fe.team_id)]={add:s(fe.allowed_pages_add??[]),remove:s(fe.allowed_pages_remove??[])}})}oe(O.map(g=>({...g,overrides:We[g.teamId]??{add:[],remove:[]}})))})().catch(t=>{const o=_(t);u.error(`Erro ao carregar permissões: ${o}`),y({add:[],remove:[]}),E({}),oe([]),ie(null)}).finally(()=>{r||Se(!1)}),()=>{r=!0}},[_,re,c?.id]);const Le=r=>r.startsWith("/dashboard/workflow")?"/dashboard/workflow":r,dr=r=>Array.isArray(r)&&r.includes("*"),cr=(r,s)=>s==="/dashboard"?r==="/dashboard":r===s||r.startsWith(`${s}/`),Ie=r=>{const s=Le(r),a=ne?.allowedPages??null;return!a||dr(a)?!0:a.some(t=>cr(s,Le(t)))},Me=(r,s)=>{r(a=>{const t=new Set(a.add),o=new Set(a.remove);return s?t.add("*"):t.delete("*"),o.delete("*"),{add:Array.from(t),remove:Array.from(o)}})},mr=(r,s)=>{r(a=>{const t=new Set(a.add),o=new Set(a.remove);return s?o.add("*"):o.delete("*"),t.delete("*"),{add:Array.from(t),remove:Array.from(o)}})},X=(r,s,a)=>{r(t=>{const o=new Set(t.add),n=new Set(t.remove);return s==="add"?o.has(a)?o.delete(a):(o.add(a),n.delete(a)):n.has(a)?n.delete(a):(n.add(a),o.delete(a)),{add:Array.from(o),remove:Array.from(n)}})},Fe=(r,s)=>{const a=String(r).trim();a&&Ce(t=>({...t,[a]:s}))},Be=r=>{const s=String(r).trim();if(!s||s!=="*"&&!s.startsWith("/dashboard"))return;const a=I[s]??"",t=Y(a);t.length!==0&&(E(o=>{const n=o[s]??[],i=Y([...n,...t].join(`
`)),d={...o};return i.length===0?delete d[s]:d[s]=i,d}),Ce(o=>({...o,[s]:""})))},Ge=(r,s)=>{const a=String(r).trim();a&&E(t=>{const n=(t[a]??[]).filter(d=>d!==s),i={...t};return n.length===0?delete i[a]:i[a]=n,i})},ur=r=>{V(r),H({add:r.overrides.add??[],remove:r.overrides.remove??[]})},fr=async()=>{if(C?.teamId){Te(!0);try{if(!v||v.role!=="admin")throw new Error("forbidden");const r=await Q();if(!r)throw new Error("not_authenticated");const s=Array.from(new Set(P.add)),a=Array.from(new Set(P.remove));if(s.find(d=>a.includes(d)))throw new Error("overlapping_permissions");const{data:o,error:n}=await f.from("team_access_overrides").select("allowed_pages_add, allowed_pages_remove").eq("team_id",C.teamId).maybeSingle();if(n)throw n;const{error:i}=await f.from("team_access_overrides").upsert({team_id:C.teamId,allowed_pages_add:s,allowed_pages_remove:a,updated_at:new Date().toISOString()},{onConflict:"team_id"});if(i)throw i;await f.rpc("insert_audit_log",{actor_id:r.id,entity_table:"team_access_overrides",entity_id:C.teamId,action:"admin_access_overrides_set_team",old_data:{allowed_pages_add:o?.allowed_pages_add??[],allowed_pages_remove:o?.allowed_pages_remove??[]},new_data:{allowed_pages_add:s,allowed_pages_remove:a}}),oe(d=>d.map(m=>m.teamId===C.teamId?{...m,overrides:{add:s,remove:a}}:m)),V(null),u.success("Permissões da equipe atualizadas")}catch(r){const s=r instanceof Error?r.message:String(r);u.error(`Erro ao salvar permissões da equipe: ${me(s)}`)}finally{Te(!1)}}},pr=async(r,s)=>{const a=s==="admin"?"member":"admin";try{if(!v||v.role!=="admin")throw new Error("forbidden");if(v.id===r&&a==="member"){u.error("Você não pode remover seu próprio acesso de administrador");return}const t=await Q();if(!t)throw new Error("not_authenticated");const{data:o,error:n}=await f.from("profiles").select("role").eq("id",r).maybeSingle();if(n)throw n;const{error:i}=await f.from("profiles").update({role:a}).eq("id",r);if(i)throw i;q(se.map(d=>d.id===r?{...d,role:a}:d)),c?.id===r&&A({...c,role:a}),await f.rpc("insert_audit_log",{actor_id:t.id,entity_table:"profiles",entity_id:r,action:"admin_role_updated",old_data:{role:o?.role??s},new_data:{role:a}}),u.success(`Permissão alterada para ${a}!`)}catch(t){console.error("Error updating role:",t);const n=(t instanceof Error?t.message:String(t))==="forbidden"?"Apenas administradores podem alterar permissões.":"Erro ao alterar permissão";u.error(n)}},xr=async(r,s)=>{const a=s==="active"?"blocked":"active";try{if(!v||v.role!=="admin")throw new Error("forbidden");if(v.id===r){u.error("Você não pode bloquear seu próprio acesso");return}const t=await Q();if(!t)throw new Error("not_authenticated");const{data:o,error:n}=await f.from("profiles").select("status").eq("id",r).maybeSingle();if(n)throw n;const{error:i}=await f.from("profiles").update({status:a}).eq("id",r);if(i)throw i;q(se.map(d=>d.id===r?{...d,status:a}:d)),c?.id===r&&A({...c,status:a}),await f.rpc("insert_audit_log",{actor_id:t.id,entity_table:"profiles",entity_id:r,action:"admin_status_updated",old_data:{status:o?.status??s},new_data:{status:a}}),u.success(`Status alterado para ${a==="active"?"Ativo":"Bloqueado"}!`)}catch(t){console.error("Error updating status:",t);const n=(t instanceof Error?t.message:String(t))==="forbidden"?"Apenas administradores podem alterar status.":"Erro ao alterar status";u.error(n)}},ze=async(r,s,a)=>{try{const t=async n=>{const i=n instanceof Error?n.message:String(n),d=typeof n=="object"&&n!==null&&"context"in n?n.context:null;if(d&&typeof d.text=="function")try{const m=await d.text();if(m){let x=null;try{x=JSON.parse(m)}catch{x=null}if(x&&typeof x=="object"){const j=x.error,b=x.details;if(typeof j=="string"&&j.trim().length>0)return typeof b=="string"&&b.trim().length>0?`${j}: ${b}`:j}return m}}catch{return i}return i},o=async n=>{try{const{data:i,error:d}=await f.functions.invoke("admin-stripe-subscription",{body:n});if(d)throw new Error(await t(d));if(i&&typeof i=="object"&&"error"in i&&i.error)throw new Error(String(i.error));return i}catch(i){throw new Error(await t(i))}};if(s){const n=await o({action:"change_plan",userId:r,planId:s,returnUrl:`${window.location.origin}/admin/users`});if(n&&typeof n=="object"&&n.code==="missing_payment_method"){const i=n.portalUrl;u.error("O usuário precisa adicionar um método de pagamento.",{description:i?"Abra o portal do Stripe para adicionar um cartão.":void 0,action:i?{label:"Abrir portal",onClick:()=>window.open(i,"_blank","noreferrer")}:void 0});return}}else await o({action:"cancel",userId:r});q(n=>n.map(i=>i.id===r?{...i,plan:a}:i)),c&&c.id===r&&A({...c,plan:a}),h&&h.id===r&&G({...h,plan:a}),await ue(ee),u.success(`Plano alterado para ${a}`)}catch(t){console.error("Error updating plan:",t);const o=t instanceof Error?t.message:String(t);let n=o;(o.includes("missing_auth")||o.includes("invalid_auth"))&&(n="Sessão expirada. Faça login novamente."),o.includes("forbidden")&&(n="Você não tem permissão de administrador para essa ação."),o.includes("rate_limited")&&(n="Muitas solicitações. Tente novamente em alguns segundos."),o.includes("plan_not_found")&&(n="Plano não encontrado."),o.includes("plan_without_gateway_id")&&(n="O plano selecionado não possui ID do Stripe (price)."),o.includes("stripe_not_configured")&&(n="Stripe não está configurado no servidor."),o.toLowerCase().includes("no such price")&&(n="O ID do preço do Stripe é inválido ou não existe neste ambiente."),o.toLowerCase().includes("no such customer")&&(n="Cliente Stripe não encontrado para este usuário."),u.error(`Erro ao alterar plano: ${n}`)}},gr=async r=>{try{u.loading("Gerando acesso...",{id:"impersonate"});const{data:s,error:a}=await f.functions.invoke("admin-impersonate",{body:{userId:r}});if(a)throw a;const t=s?.link;if(!t)throw new Error("Link não gerado");const o=new URL(t);o.searchParams.set("redirect_to",`${window.location.origin}/dashboard`),window.open(o.toString(),"_blank"),u.success("Acesso gerado! Link aberto em nova aba.",{id:"impersonate"}),u.info("Use uma janela anônima se não quiser sair da sua conta admin.")}catch(s){console.error(s),u.error("Erro ao gerar acesso",{id:"impersonate"})}},Ve=se.filter(r=>r.name.toLowerCase().includes($.toLowerCase())||r.email.toLowerCase().includes($.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4 items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-1",children:"Usuários"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie acessos e permissões."})]}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{value:$,onChange:r=>er(r.target.value),placeholder:"Buscar usuário...",className:"w-full bg-muted/10 border border-border rounded-xl pl-10 pr-4 py-2 focus:border-purple-500 outline-none transition-all"})]})]}),e.jsx("div",{className:"grid gap-4",children:sr?e.jsx(ge,{className:"p-6 text-center text-muted-foreground",children:"Carregando usuários..."}):Ve.length===0?e.jsx(ge,{className:"p-6 text-center text-muted-foreground",children:"Nenhum usuário encontrado."}):Ve.map(r=>e.jsxs(ge,{className:"p-4 flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 group hover:bg-muted/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full lg:w-auto",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex flex-shrink-0 items-center justify-center text-white font-bold text-lg",children:r.name.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2 truncate",children:[r.name,r.role==="admin"&&e.jsx(vr,{className:"w-3 h-3 text-purple-600 dark:text-purple-400 fill-purple-400/20 flex-shrink-0"})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:r.email})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 w-full lg:w-auto mt-2 lg:mt-0",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium px-3 py-1.5 rounded-full bg-muted/20 border border-border whitespace-nowrap",children:[e.jsx("span",{className:"text-muted-foreground",children:"Plano:"}),e.jsx("span",{className:"text-foreground font-semibold",children:r.plan})]}),e.jsx("div",{className:`px-3 py-1.5 rounded-full text-xs font-bold uppercase whitespace-nowrap ${r.status==="active"?"bg-green-100 text-green-700 dark:bg-green-500/10 dark:text-green-400 border border-green-200 dark:border-green-500/20":"bg-red-100 text-red-700 dark:bg-red-500/10 dark:text-red-400 border border-red-200 dark:border-red-500/20"}`,children:r.status==="active"?"Ativo":"Bloqueado"})]}),e.jsxs(jr,{children:[e.jsx(yr,{asChild:!0,children:e.jsx("button",{className:"p-2 rounded-lg hover:bg-muted/10 transition-colors ml-auto sm:ml-0 self-end sm:self-center",children:e.jsx(Nr,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs(_r,{align:"end",className:"w-56 bg-background/95 backdrop-blur-xl border-border",children:[e.jsx(kr,{children:"Ações da Conta"}),e.jsx(Ke,{className:"bg-border"}),e.jsxs(F,{className:"cursor-pointer gap-2",onClick:()=>G(r),children:[e.jsx(wr,{className:"w-4 h-4"}),"Gerenciar Plano"]}),e.jsxs(F,{onClick:()=>pr(r.id,r.role),className:"cursor-pointer gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),r.role==="admin"?"Remover Admin":"Tornar Admin"]}),e.jsxs(F,{onClick:()=>xr(r.id,r.status),className:"cursor-pointer gap-2 text-destructive focus:text-destructive",children:[e.jsx(qr,{className:"w-4 h-4"}),r.status==="active"?"Bloquear Acesso":"Desbloquear"]}),e.jsxs(F,{className:"cursor-pointer gap-2",onClick:()=>gr(r.id),children:[e.jsx(Ir,{className:"w-4 h-4"}),"Acessar Conta"]}),e.jsx(Ke,{className:"bg-border"}),e.jsxs(F,{className:"cursor-pointer gap-2",onClick:()=>A(r),children:[e.jsx(Xe,{className:"w-4 h-4"}),"Ver detalhes"]})]})]})]})]},r.id))}),e.jsx(he,{open:!!c,onOpenChange:r=>!r&&A(null),children:e.jsxs(be,{className:"w-[95vw] sm:w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-background/95 border-border rounded-2xl p-4 sm:p-6 gap-4",children:[e.jsxs(ve,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-white font-bold shrink-0",children:c?.name.charAt(0)}),e.jsxs("div",{children:[e.jsx(we,{className:"text-lg font-bold",children:c?.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c?.email})]})]}),e.jsx(je,{className:"sr-only",children:"Gerencie permissões e equipes do usuário selecionado."})]}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 text-sm bg-muted/20 p-3 rounded-xl border border-border",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs uppercase tracking-wider",children:"Plano atual"}),e.jsx("p",{className:"font-medium",children:c.plan})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs uppercase tracking-wider",children:"Status"}),e.jsx("p",{className:"font-medium",children:c.status==="active"?"Ativo":c.status==="blocked"?"Bloqueado":c.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs uppercase tracking-wider",children:"Tipo de acesso"}),e.jsx("p",{className:"font-medium",children:c.role==="admin"?"Administrador":"Membro"})]})]}),e.jsx("div",{className:"space-y-4",children:L?e.jsxs("div",{className:"py-6 text-center text-muted-foreground text-sm flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"}),"Carregando permissões..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Permissões extras (usuário)"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[ae==="saving"?e.jsx(Or,{className:"w-4 h-4 animate-spin"}):ae==="saved"?e.jsx(Ur,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):ae==="error"?e.jsx(xe,{className:"w-4 h-4 text-destructive"}):null,e.jsx("span",{children:ar})]}),w.add.some(r=>!Ie(r))&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-xl flex items-start gap-3 animate-in fade-in slide-in-from-top-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:[e.jsx("p",{className:"font-semibold",children:"Atenção: Permissões fora do plano"}),e.jsxs("p",{children:["Você está concedendo acesso a páginas que não fazem parte do plano ",e.jsx("strong",{children:ne?.name}),". O usuário terá acesso independentemente do plano."]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 rounded-xl border border-border bg-card/50 p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium",children:"Liberar todas as páginas"}),e.jsxs("div",{className:"text-[10px] text-muted-foreground truncate",children:["Plano: ",ne?.name??c.plan]})]}),e.jsxs("div",{className:"flex items-center gap-2 self-end sm:self-auto",children:[e.jsx(Ne,{htmlFor:"user-all-access",className:"sr-only",children:"Liberar todas as páginas"}),e.jsx(ye,{id:"user-all-access",checked:w.add.includes("*"),onCheckedChange:r=>N(()=>Me(y,!!r))})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:B.map(r=>{const s=w.add.includes(r.id),a=w.add.includes("*"),t=Ie(r.id),o=()=>{const n=!s;N(()=>{X(y,"add",r.id)}),n&&!t&&u.warning("Atenção: Fora do plano",{description:"Esta página não faz parte do plano do usuário.",duration:3e3})};return e.jsx("div",{onClick:o,onKeyDown:n=>{a||(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),o())},role:"button",tabIndex:a?-1:0,"aria-disabled":a,className:`flex items-center justify-between gap-3 p-3 rounded-xl border text-left transition-all ${s?"bg-primary/5 border-primary/20":"bg-card border-border hover:border-primary/20 hover:bg-muted/50"} ${a?"opacity-60 cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-start gap-3 min-w-0",children:[e.jsx(Z,{checked:s,onCheckedChange:o,onClick:n=>n.stopPropagation(),disabled:a,className:"mt-1"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:r.label}),e.jsx("div",{className:`text-[10px] px-2 py-0.5 rounded-full border whitespace-nowrap ${t?"bg-green-500/10 border-green-500/20 text-green-600 dark:text-green-400":"bg-yellow-500/10 border-yellow-500/20 text-yellow-700 dark:text-yellow-400"}`,children:t?"No plano":"Fora do plano"})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:r.id})]})]})},`add:${r.id}`)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Permissões removidas (usuário)"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 rounded-xl border border-border bg-card/50 p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium",children:"Revogar todas as páginas"}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:"Bloqueia todas as páginas do dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-2 self-end sm:self-auto",children:[e.jsx(Ne,{htmlFor:"user-all-block",className:"sr-only",children:"Revogar todas as páginas"}),e.jsx(ye,{id:"user-all-block",checked:w.remove.includes("*"),onCheckedChange:r=>N(()=>mr(y,!!r))})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:B.map(r=>{const s=w.remove.includes("*"),a=s||w.remove.includes(r.id),t=()=>{s||N(()=>{X(y,"remove",r.id)})};return e.jsx("div",{onClick:t,onKeyDown:o=>{s||(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),t())},role:"button",tabIndex:s?-1:0,"aria-disabled":s,className:`flex items-center justify-between gap-3 p-3 rounded-xl border text-left transition-all ${a?"bg-red-500/10 border-red-500/20":"bg-card border-border hover:border-red-500/20 hover:bg-muted/50"} ${s?"opacity-60 cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-start gap-3 min-w-0",children:[e.jsx(Z,{checked:a,onCheckedChange:t,onClick:o=>o.stopPropagation(),disabled:s,className:"mt-1"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:r.label}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:r.id})]})]})},`remove:${r.id}`)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Ferramentas desativadas (usuário)"}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["Use IDs de botões/inputs (ex: o atributo ",e.jsx("span",{className:"font-mono",children:"id"}),"). Um por linha ou separado por vírgula."]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl border border-border bg-card/50 p-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-3",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium",children:"Todas as páginas"}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:"Aplicar via *"})]})}),e.jsxs("div",{className:"mt-2",children:[(S["*"]??[]).length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:(S["*"]??[]).map(r=>e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-border bg-muted/20 px-2 py-1 text-xs",children:[e.jsx("span",{className:"font-mono",children:r}),e.jsx("button",{type:"button",className:"p-0.5 rounded-full hover:bg-muted",onClick:()=>N(()=>Ge("*",r)),"aria-label":`Remover ${r}`,children:e.jsx(xe,{className:"w-3 h-3"})})]},`*:${r}`))}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Nenhuma ferramenta desativada globalmente."}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(Je,{value:I["*"]??"",onChange:r=>Fe("*",r.target.value),placeholder:"Ex: create-button\\nsubmit-form",className:"h-9 text-xs bg-background/60"}),e.jsx(U,{type:"button",variant:"glass",className:"h-9 px-3",onClick:()=>N(()=>Be("*")),disabled:Y(I["*"]??"").length===0,children:e.jsx(Ye,{className:"w-4 h-4"})})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:B.map(r=>e.jsxs("div",{className:"rounded-xl border border-border bg-card/50 p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:r.label}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:r.id})]}),e.jsxs("div",{className:"mt-2",children:[(S[r.id]??[]).length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:(S[r.id]??[]).map(s=>e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-border bg-muted/20 px-2 py-1 text-xs",children:[e.jsx("span",{className:"font-mono",children:s}),e.jsx("button",{type:"button",className:"p-0.5 rounded-full hover:bg-muted",onClick:()=>N(()=>Ge(r.id,s)),"aria-label":`Remover ${s}`,children:e.jsx(xe,{className:"w-3 h-3"})})]},`${r.id}:${s}`))}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Nenhuma ferramenta desativada nesta página."}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(Je,{value:I[r.id]??"",onChange:s=>Fe(r.id,s.target.value),placeholder:"Ex: create-button\\nsubmit-form",className:"h-9 text-xs bg-background/60"}),e.jsx(U,{type:"button",variant:"glass",className:"h-9 px-3",onClick:()=>N(()=>Be(r.id)),disabled:Y(I[r.id]??"").length===0,children:e.jsx(Ye,{className:"w-4 h-4"})})]})]})]},`tools:${r.id}`))})]})]}),Ee.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Equipes"}),e.jsx("div",{className:"space-y-2",children:Ee.map(r=>e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 rounded-xl border bg-card/50",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:r.name}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:r.memberRole})]}),e.jsx("button",{type:"button",className:"text-xs text-primary hover:underline px-2 py-1",onClick:()=>ur(r),children:"Editar"})]},r.teamId))})]})]})}),e.jsx("div",{className:"flex flex-col-reverse sm:flex-row gap-3 pt-2",children:e.jsx(U,{className:"w-full sm:w-auto",variant:"glass",onClick:()=>A(null),children:"Fechar"})})]})]})}),e.jsx(Sr,{open:tr,onOpenChange:r=>{te(r),r||(z.current=null)},children:e.jsxs(Cr,{children:[e.jsxs(Ar,{children:[e.jsx(Er,{children:or}),e.jsx(Dr,{children:ir})]}),e.jsxs(Tr,{children:[e.jsx(Pr,{children:"Cancelar"}),e.jsx(Rr,{onClick:()=>{const r=z.current;te(!1),z.current=null,r?.()},children:"Confirmar"})]})]})}),e.jsx(he,{open:!!C,onOpenChange:r=>!r&&V(null),children:e.jsxs(be,{className:"w-[95vw] sm:w-full max-w-2xl max-h-[90vh] overflow-y-auto bg-background/95 backdrop-blur-xl border-border",children:[e.jsxs(ve,{children:[e.jsxs(we,{children:["Permissões da equipe: ",C?.name]}),e.jsx(je,{className:"sr-only",children:"Ajuste permissões de páginas para a equipe selecionada."})]}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Permissões extras (equipe)"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 rounded-xl border border-border bg-card/50 p-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium",children:"Liberar todas as páginas"}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:"Aplicável a todos os membros da equipe"})]}),e.jsxs("div",{className:"flex items-center gap-2 self-end sm:self-auto",children:[e.jsx(Ne,{htmlFor:"team-all-access",className:"sr-only",children:"Liberar todas as páginas"}),e.jsx(ye,{id:"team-all-access",checked:(P.add??[]).includes("*"),onCheckedChange:r=>Me(H,!!r)})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:B.map(r=>{const s=P.add.includes(r.id),a=P.add.includes("*"),t=()=>{X(H,"add",r.id)};return e.jsx("div",{onClick:t,onKeyDown:o=>{a||(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),t())},role:"button",tabIndex:a?-1:0,"aria-disabled":a,className:`flex items-center justify-between gap-3 p-3 rounded-xl border text-left transition-all ${s?"bg-primary/5 border-primary/20":"bg-card border-border hover:border-primary/20 hover:bg-muted/50"} ${a?"opacity-60 cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-start gap-3 min-w-0",children:[e.jsx(Z,{checked:s,onCheckedChange:t,onClick:o=>o.stopPropagation(),disabled:a,className:"mt-1"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:r.label}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:r.id})]})]})},`team:add:${r.id}`)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Permissões removidas (equipe)"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:B.map(r=>{const s=P.remove.includes(r.id),a=()=>{X(H,"remove",r.id)};return e.jsx("div",{onClick:a,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),a())},role:"button",tabIndex:0,className:`flex items-center justify-between gap-3 p-3 rounded-xl border text-left transition-all ${s?"bg-red-500/10 border-red-500/20":"bg-card border-border hover:border-red-500/20 hover:bg-muted/50"}`,children:e.jsxs("div",{className:"flex items-start gap-3 min-w-0",children:[e.jsx(Z,{checked:s,onCheckedChange:a,onClick:t=>t.stopPropagation(),className:"mt-1"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:r.label}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:r.id})]})]})},`team:remove:${r.id}`)})})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 pt-2",children:[e.jsx(U,{className:"w-full sm:w-auto",variant:"glass",onClick:()=>V(null),children:"Cancelar"}),e.jsx(U,{className:"w-full sm:w-auto sm:ml-auto",onClick:()=>{fr()},disabled:De,children:De?"Salvando...":"Salvar permissões da equipe"})]})]})]})}),e.jsx(he,{open:!!h,onOpenChange:r=>!r&&G(null),children:e.jsxs(be,{className:"w-[95vw] sm:w-full max-w-lg max-h-[90vh] overflow-y-auto bg-background/95 backdrop-blur-xl border-border",children:[e.jsxs(ve,{children:[e.jsxs(we,{children:["Alterar Plano de ",h?.name]}),e.jsx(je,{className:"sr-only",children:"Selecione um plano para aplicar ao usuário."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid gap-3",children:[re.map(r=>e.jsxs("button",{onClick:()=>h&&ze(h.id,r.id,r.name),className:`flex items-center justify-between p-4 rounded-xl border transition-all ${h?.plan===r.name?"bg-purple-100 dark:bg-purple-500/10 border-purple-300 dark:border-purple-500/50":"bg-muted/30 border-border hover:bg-muted/50"}`,children:[e.jsxs("div",{className:"flex flex-col items-start text-left",children:[e.jsx("span",{className:"font-bold",children:r.name}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["R$ ",r.price.toLocaleString("pt-BR",{minimumFractionDigits:2})," / ",r.interval==="monthly"?"mês":"ano"]})]}),h?.plan===r.name&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500 shadow-[0_0_10px_rgba(168,85,247,0.5)] shrink-0 ml-2"})]},r.id)),e.jsxs("button",{onClick:()=>h&&ze(h.id,null,"Free"),className:`flex items-center justify-between p-4 rounded-xl border transition-all ${h?.plan==="Free"?"bg-purple-100 dark:bg-purple-500/10 border-purple-300 dark:border-purple-500/50":"bg-muted/30 border-border hover:bg-muted/50"}`,children:[e.jsxs("div",{className:"flex flex-col items-start text-left",children:[e.jsx("span",{className:"font-bold",children:"Free"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Gratuito"})]}),h?.plan==="Free"&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500 shadow-[0_0_10px_rgba(168,85,247,0.5)] shrink-0 ml-2"})]})]}),e.jsx(U,{className:"w-full",variant:"glass",onClick:()=>G(null),children:"Cancelar"})]})]})})]})}export{ls as default};
