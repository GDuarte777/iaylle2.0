import{c as $,j as t,I as i,H as l,o as e,aZ as q,N as j,ac as z}from"./index-DidJ2IC_.js";import{G as I}from"./GlassCard-i8sBZgct.js";import{I as v}from"./input-RWOkaWNK.js";import{S as K}from"./switch-6ZvdsyJf.js";import{L as P}from"./label-i_K-zmDS.js";import{T as O}from"./textarea-Bu6j6FbR.js";import{T as V,a as Z,b as B,c as b,d as J,e as N}from"./table-Bqyslwhj.js";import{S as Q}from"./search-CTyYii5Y.js";import{P as U}from"./plus-C9Z0pS98.js";import"./index-CffAzoJ_.js";import"./index-DKXZ3643.js";const W=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],X=$("flag",W);function de(){const[D,y]=t.useState(!0),[w,d]=t.useState(null),[u,M]=t.useState(""),[g,x]=t.useState([]),[k,C]=t.useState(!0),[S,E]=t.useState(!1),[f,_]=t.useState("Esta funcionalidade não está disponível no seu plano atual ou não foi liberada para sua conta."),[m,A]=t.useState(""),[h,T]=t.useState(""),[p,F]=t.useState(!1),c=t.useCallback(async()=>{y(!0);try{const{data:s,error:a}=await i.from("feature_flags").select("key, description, enabled, updated_at").order("key",{ascending:!0});if(a)throw a;x(s??[])}catch(s){const a=s instanceof Error?s.message:String(s);l.error(`Erro ao carregar flags: ${a}`),x([])}finally{y(!1)}},[]);t.useEffect(()=>{c()},[c]),t.useEffect(()=>{let s=!1;return C(!0),(async()=>{const{data:r,error:o}=await i.from("app_settings").select("value").eq("key","access_control").maybeSingle();if(s||o)return;const n=r?.value?.blocked_tool_message;typeof n=="string"&&n.trim().length>0&&_(n.trim())})().catch(()=>{}).finally(()=>{s||C(!1)}),()=>{s=!0}},[]);const G=t.useCallback(async()=>{const s=f.trim();if(!s){l.error("Informe a mensagem de bloqueio");return}E(!0);try{const{error:a}=await i.from("app_settings").upsert({key:"access_control",value:{blocked_tool_message:s},updated_at:new Date().toISOString()},{onConflict:"key"});if(a)throw a;l.success("Configuração salva")}catch(a){const r=a instanceof Error?a.message:String(a);l.error("Erro ao salvar configuração",{description:r})}finally{E(!1)}},[f]),L=t.useMemo(()=>{const s=u.trim().toLowerCase();return s?g.filter(a=>a.key.toLowerCase().includes(s)||(a.description??"").toLowerCase().includes(s)):g},[g,u]),H=t.useCallback(async(s,a)=>{d(s);try{const{error:r}=await i.from("feature_flags").update({enabled:a}).eq("key",s);if(r)throw r;x(o=>o.map(n=>n.key===s?{...n,enabled:a}:n))}catch(r){const o=r instanceof Error?r.message:String(r);l.error(`Erro ao atualizar flag: ${o}`)}finally{d(null)}},[]),R=t.useCallback(async()=>{const s=m.trim();if(!s){l.error("Informe uma key");return}d(s);try{const{error:a}=await i.from("feature_flags").insert({key:s,description:h.trim()||null,enabled:p});if(a)throw a;l.success("Flag criada"),A(""),T(""),F(!1),await c()}catch(a){const r=a instanceof Error?a.message:String(a);l.error(`Erro ao criar flag: ${r}`)}finally{d(null)}},[c,h,p,m]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-3",children:[e.jsx(q,{className:"w-8 h-8 text-purple-600 dark:text-purple-400"}),"Configurações Globais"]}),e.jsx("p",{className:"text-muted-foreground",children:"Feature flags e parâmetros globais."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:w-96",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(v,{value:u,onChange:s=>M(s.target.value),placeholder:"Buscar por key ou descrição...",className:"pl-10 bg-background/60"})]}),e.jsxs(j,{variant:"glass",onClick:()=>{c()},className:"gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Atualizar"]})]})]}),e.jsxs(I,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(X,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Feature Flags"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Key"}),e.jsx(v,{value:m,onChange:s=>A(s.target.value),placeholder:"ex: billing_block"})]}),e.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Descrição"}),e.jsx(v,{value:h,onChange:s=>T(s.target.value),placeholder:"ex: Bloqueia cobrança por uso excedido"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{id:"new-flag-enabled",checked:p,onCheckedChange:F}),e.jsx(P,{htmlFor:"new-flag-enabled",children:"Ativada"})]}),e.jsx("div",{className:"lg:col-span-2 flex justify-end",children:e.jsxs(j,{variant:"neon",onClick:()=>{R()},className:"gap-2",disabled:w===m.trim(),children:[e.jsx(U,{className:"w-4 h-4"}),"Criar"]})})]}),D?e.jsx("div",{className:"py-10 text-center text-muted-foreground",children:"Carregando..."}):L.length===0?e.jsx("div",{className:"py-10 text-center text-muted-foreground",children:"Nenhuma flag encontrada."}):e.jsxs(V,{children:[e.jsx(Z,{children:e.jsxs(B,{children:[e.jsx(b,{children:"Key"}),e.jsx(b,{children:"Descrição"}),e.jsx(b,{className:"text-right",children:"Ativa"})]})}),e.jsx(J,{children:L.map(s=>e.jsxs(B,{children:[e.jsx(N,{className:"font-medium",children:s.key}),e.jsx(N,{className:"text-muted-foreground",children:s.description??"—"}),e.jsx(N,{className:"text-right",children:e.jsx("div",{className:"inline-flex items-center gap-3",children:e.jsx(K,{checked:s.enabled,disabled:w===s.key,onCheckedChange:a=>{H(s.key,a)}})})})]},s.key))})]})]}),e.jsxs(I,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(q,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Controle de Acesso"})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Mensagem de bloqueio (toast)"}),e.jsx(O,{value:f,onChange:s=>_(s.target.value),className:"min-h-[110px] bg-background/60",disabled:k||S})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{variant:"neon",disabled:k||S,onClick:()=>{G()},children:"Salvar"})})]})]})]})}export{de as default};
