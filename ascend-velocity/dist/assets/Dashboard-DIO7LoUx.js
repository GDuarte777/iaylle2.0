const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DidJ2IC_.js","assets/index-BX7XDR4e.css"])))=>i.map(i=>d[i]);
import{c as et,O as he,I as $,H as A,_ as cr,P as Wt,Q as ut,U as mr,V as _t,j as x,o as e,X as ur,Y as fr,E as xr,Z as hr,J as gr,$ as pr,a0 as Je,a1 as ot,a2 as St,a3 as Et,a4 as At,a5 as br,a6 as wr,a7 as vr,C as Dt,L as $t}from"./index-DidJ2IC_.js";import{a as Mt}from"./index-BH-fAadi.js";import{B as Ge}from"./button-DTTbzLxY.js";import{I as Ee}from"./input-RWOkaWNK.js";import{T as yr,a as jr,b as it,c as lt}from"./tabs-BkiDHpMy.js";import{G as xe}from"./GlassCard-i8sBZgct.js";import{D as Ie,a as Fe,b as Pe,c as Nr,d as kr}from"./dialog-CdV5WMHG.js";import{C as Ae}from"./calendar-CGf-h3Mg.js";import{c as Tt,A as Lt}from"./gamificationUtils-CaO2KR3h.js";import{S as Qe}from"./square-pen-CUrgifGC.js";import{T as Oe}from"./trash-2-CBwffM0k.js";import{T as Cr}from"./trending-up-CNsvjfXj.js";import{S as _r}from"./star-C2_qKbDI.js";import{Z as dt}from"./zap-DlHyxlKp.js";import{L as Sr}from"./list-BDjjj4yB.js";import{S as It}from"./search-CTyYii5Y.js";import{T as Er}from"./target-DMzcJdGI.js";import"./index-DKXZ3643.js";import"./index-D2QiG8fX.js";import"./index-CKOwKrdC.js";import"./index-KU_foAP1.js";import"./index-B17yf-n8.js";const Ar=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Ft=et("chart-column",Ar);const Dr=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Pt=et("circle-check-big",Dr);const $r=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Mr=et("grid-3x3",$r);const Tr=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ot=et("user-x",Tr),qt=new Set(["Afiliada Exemplo 1","Afiliada Exemplo 2","Afiliada Exemplo 3"]);function Ze(a,r){if(!r)return a;const s=a;return s&&typeof s.abortSignal=="function"?s.abortSignal(r):a}function Rt(a){const r=new Map;for(const c of a||[]){const u=c?.name;if(!qt.has(u))continue;const d=r.get(u);if(!d){r.set(u,c);continue}const y=d?.created_at?Date.parse(d.created_at):Number.POSITIVE_INFINITY,g=c?.created_at?Date.parse(c.created_at):Number.POSITIVE_INFINITY;Number.isFinite(g)&&(g<y||!Number.isFinite(y))&&r.set(u,c)}const s=new Set(Array.from(r.values()).map(c=>c?.id).filter(Boolean));return(a||[]).filter(c=>{const u=c?.name;return qt.has(u)?s.has(c?.id):!0})}async function qe(a){try{const r=await he();if(!r)return A.error("Usu√°rio n√£o autenticado"),!1;if(!await Wt(r.id))return A.error("Esta funcionalidade n√£o est√° dispon√≠vel no seu plano atual."),!1;const c=$.from("subscriptions").select("id").eq("user_id",r.id).in("status",["active","trialing","past_due"]).limit(1).maybeSingle(),{data:u}=await Ze(c,a);if(u?.id)return!0;const d=$.from("app_settings").select("value").eq("key","billing_settings").maybeSingle(),{data:y}=await Ze(d,a),g=y?.value,w=typeof g?.free_usage_limit=="number"?g.free_usage_limit:null;if(typeof w!="number")return!0;const S=Math.max(0,w);if(S<=0)return!0;const C=$.from("affiliates").select("id",{count:"exact",head:!0}).eq("owner_user_id",r.id).eq("status","active"),{count:T}=await Ze(C,a);if((typeof T=="number"?T:0)>=S){A.error("Limite do plano Free atingido. Fa√ßa upgrade para continuar.");try{window.location.href="/dashboard/settings"}catch(X){}return!1}return!0}catch{return!1}}async function tt(){const a=await he();if(!a)return{userId:null,affiliateIds:[]};const{data:r,error:s}=await $.from("affiliates").select("id").eq("owner_user_id",a.id);if(s)return{userId:a.id,affiliateIds:[]};const c=(r||[]).map(u=>u.id).filter(Boolean);return{userId:a.id,affiliateIds:c}}async function Bt(){const a=await he();if(!a)return[];const{data:r,error:s}=await $.from("affiliates").select("*").eq("owner_user_id",a.id).eq("status","active").order("created_at",{ascending:!1});if(s)return console.error("Error fetching affiliates:",s),[];if(!r||r.length===0){const{error:c}=await $.rpc("ensure_default_affiliates");if(c)return[];const{data:u,error:d}=await $.from("affiliates").select("*").eq("owner_user_id",a.id).eq("status","active").order("created_at",{ascending:!1});return d?[]:Rt(u||[])}return Rt(r||[])}async function Lr(a,r,s,c,u){if(!await qe(u?.signal))return null;const y=await he();if(!y)return A.error("Usu√°rio n√£o autenticado"),null;const g=typeof r=="string"?r.trim():"",w=$.from("affiliates").insert({owner_user_id:y.id,name:a,instagram:g||null,instagram_link:s,notes:c,status:"active"}).select().single(),{data:S,error:C}=await Ze(w,u?.signal);return C?(console.error("Error adding affiliate:",C),A.error("Erro ao adicionar afiliada"),null):S}async function Ir(a,r){if(!await qe())return!1;const c=await he();if(!c)return A.error("Usu√°rio n√£o autenticado"),!1;const{error:u}=await $.from("affiliates").update(r).eq("id",a).eq("owner_user_id",c.id);return u?(console.error("Error updating affiliate:",u),A.error("Erro ao atualizar afiliada"),!1):!0}async function Fr(a){if(!await qe())return!1;const s=await he();if(!s)return A.error("Usu√°rio n√£o autenticado"),!1;const{data:c,error:u}=await $.from("affiliates").select("id, owner_user_id").eq("id",a).eq("owner_user_id",s.id).maybeSingle();if(u||!c?.id)return A.error("Afiliada n√£o encontrada"),!1;let d;try{d=c?.owner_user_id}catch{}const{error:y}=await $.from("affiliate_achievements").delete().eq("affiliate_id",a);if(y)if(y.code==="PGRST205")try{if(d){const{error:S}=await $.from("user_achievements").delete().eq("user_id",d);S&&console.warn("Fallback user_achievements failed:",S)}}catch{}else return console.error("Error deleting related achievements:",y),A.error("Erro ao remover conquistas relacionadas"),!1;const{error:g}=await $.from("affiliate_metrics").delete().eq("affiliate_id",a);if(g)if(g.code==="PGRST205"){const{error:S}=await $.from("calendar_events").delete().eq("affiliate_id",a);if(S)return console.error("Error deleting related metrics (fallback):",S),A.error("Erro ao remover m√©tricas relacionadas"),!1}else return console.error("Error deleting related metrics:",g),A.error("Erro ao remover m√©tricas relacionadas"),!1;const{error:w}=await $.from("affiliates").delete().eq("id",a).eq("owner_user_id",s.id);return w?(console.error("Error deleting affiliate:",w),A.error("Erro ao remover afiliada"),!1):!0}async function Ut(){const{userId:a,affiliateIds:r}=await tt();if(!a)return{};if(!r.length)return{};const{data:s,error:c}=await $.from("affiliate_metrics").select("affiliate_id, date, status").in("affiliate_id",r);if(c)return console.error("Error fetching statuses:",c),{};const u={};return s?.forEach(d=>{u[`${d.affiliate_id}:${d.date}`]=d.status}),u}async function mt(a,r){const s=new Date(a,r,1).toISOString().split("T")[0],c=new Date(a,r+1,0).toISOString().split("T")[0],{userId:u,affiliateIds:d}=await tt();if(!u)return{};if(!d.length)return{};const{data:y,error:g}=await $.from("affiliate_metrics").select("affiliate_id, date, status").in("affiliate_id",d).gte("date",s).lte("date",c);if(g)return console.error("Error fetching month statuses:",g),{};const w={};return y?.forEach(S=>{w[`${S.affiliate_id}:${S.date}`]=S.status}),w}async function Pr(a,r){if(!await qe())return!1;const c=new Date(a,r,1).toISOString().split("T")[0],u=new Date(a,r+1,0).toISOString().split("T")[0],{userId:d,affiliateIds:y}=await tt();if(!d)return A.error("Usu√°rio n√£o autenticado"),!1;if(!y.length)return!0;const{error:g}=await $.from("affiliate_metrics").delete().in("affiliate_id",y).gte("date",c).lte("date",u);if(g)return console.error("Error deleting month metrics:",g),A.error("Erro ao apagar dados do m√™s"),!1;const w=`${a}-${String(r+1).padStart(2,"0")}`,{error:S}=await $.from("affiliate_achievements").delete().in("affiliate_id",y).or(`period_tag.eq.${w},period_tag.like.${w}-%`);return S?(console.error("Error deleting month achievements:",S),A.error("Erro ao apagar conquistas do m√™s"),!1):!0}async function Vt(a,r,s){if(!await qe())return!1;const u=await he();if(!u)return A.error("Usu√°rio n√£o autenticado"),!1;const{data:d,error:y}=await $.from("affiliates").select("id").eq("id",a).eq("owner_user_id",u.id).maybeSingle();if(y||!d?.id)return A.error("Afiliada n√£o encontrada"),!1;if(s===null){const{error:g}=await $.from("affiliate_metrics").delete().eq("affiliate_id",a).eq("date",r);if(g)return console.error("Error clearing status:",g),A.error("Erro ao limpar status"),!1}else{const{error:g}=await $.from("affiliate_metrics").upsert({affiliate_id:a,date:r,status:s},{onConflict:"affiliate_id,date"});if(g)return console.error("Error saving status:",g),A.error("Erro ao salvar status"),!1}(async()=>{try{const g=(await cr(async()=>{const{useStatusConfig:N}=await import("./index-DidJ2IC_.js").then(R=>R.a_);return{useStatusConfig:N}},__vite__mapDeps([0,1]))).useStatusConfig.getState(),w=r.slice(0,7),{data:S}=await $.from("affiliate_metrics").select("*").eq("affiliate_id",a),C={};(S||[]).forEach(N=>{C[`${a}:${N.date}`]=N.status});const T={},{data:O}=await $.from("affiliate_achievements").select("id, achievement_id, period_tag").eq("affiliate_id",a);(O||[]).forEach(N=>{const R=N.period_tag?`${N.achievement_id}@${N.period_tag}`:N.achievement_id;T[R]=N.id});const X=[],_=[];if(g.achievements.forEach(N=>{const R=new Set(N.classKeys||[]),H=Object.entries(C).filter(([I,p])=>I.startsWith(`${a}:`)&&R.has(p)).map(([I])=>new Date(I.split(":")[1])).sort((I,p)=>I.getTime()-p.getTime());let B=!1,J=null;if((N.streakDays||0)>0){let I=H;if(N.timeWindow==="month")I=H.filter(i=>i.toISOString().slice(0,7)===w),J=w;else if(N.timeWindow==="week")try{const i=new Date(r),h=(i.getUTCDay()+6)%7,l=new Date(i);l.setUTCDate(i.getUTCDate()-h);const f=new Date(l);f.setUTCDate(l.getUTCDate()+6);const j=l.toISOString().slice(0,10),b=f.toISOString().slice(0,10);I=H.filter(P=>{const ee=P.toISOString().slice(0,10);return ee>=j&&ee<=b}),J=`${j}`}catch(i){console.error("Error calculating week dates:",i),I=[]}else J=null;let p=0,D=null;B=!1;for(const i of I){if(D){let o=Math.round((i.getTime()-D.getTime())/864e5);if(N.ignoreDays&&N.ignoreDays.length>0){const h=new Date(D);h.setUTCDate(h.getUTCDate()+1);let l=0;for(;h<i&&l<30;)N.ignoreDays.includes(h.getUTCDay())&&o--,h.setUTCDate(h.getUTCDate()+1),l++}p=o===1?p+1:1}else p=1;if(D=i,p>=(N.streakDays||0)){B=!0;break}}}else if((N.countThreshold||0)>0)if(N.timeWindow==="month")B=H.filter(p=>p.toISOString().slice(0,7)===w).length>=(N.countThreshold||0),J=w;else if(N.timeWindow==="week")try{const I=new Date(r),D=(I.getUTCDay()+6)%7,i=new Date(I);i.setUTCDate(I.getUTCDate()-D);const o=new Date(i);o.setUTCDate(i.getUTCDate()+6);const h=i.toISOString().slice(0,10),l=o.toISOString().slice(0,10);B=H.filter(j=>{const b=j.toISOString().slice(0,10);return b>=h&&b<=l}).length>=(N.countThreshold||0),J=`${h}`}catch(I){console.error("Error calculating week count:",I),B=!1}else B=H.length>=(N.countThreshold||0),J=null;const oe=J?`${N.id}@${J}`:N.id;B&&!T[oe]?X.push({achievement_id:N.id,period_tag:J,points_awarded:N.xp}):!B&&T[oe]&&_.push(T[oe])}),X.length){const N=X.map(H=>({affiliate_id:a,achievement_id:H.achievement_id,period_tag:H.period_tag,points_awarded:H.points_awarded,awarded_at:new Date().toISOString()})),{error:R}=await $.from("affiliate_achievements").insert(N);R||window.dispatchEvent(new CustomEvent("achievement-awarded"))}if(_.length){const{error:N}=await $.from("affiliate_achievements").delete().in("id",_);N?console.error("Error removing achievements:",N):window.dispatchEvent(new CustomEvent("achievement-awarded"))}}catch(g){console.error("Error evaluating achievements:",g)}})();try{window.dispatchEvent(new CustomEvent("calendar-status-updated",{detail:{affiliateId:a,date:r,status:s}}))}catch{}return!0}async function zt(){const{userId:a,affiliateIds:r}=await tt();if(!a)return{};if(!r.length)return{};const{data:s,error:c}=await $.from("affiliate_achievements").select("affiliate_id, achievement_id, period_tag").in("affiliate_id",r);if(c)return{};const u={};return(s||[]).forEach(d=>{const y=d.period_tag?`${d.achievement_id}@${d.period_tag}`:d.achievement_id;u[d.affiliate_id]||(u[d.affiliate_id]={}),u[d.affiliate_id][y]=!0}),u}window.__calendarStatuses=window.__calendarStatuses||{};window.__affiliatePoints=window.__affiliatePoints||{};window.__awardedAchievements=window.__awardedAchievements||{};window.__loadedMonths=window.__loadedMonths||{};window.selectedAfiliada=null;window.currentMonth=new Date().getMonth();window.currentYear=new Date().getFullYear();window.defaultConfig={background_color:"#f8fafc",card_color:"#ffffff",text_color:"#1e293b",primary_color:"#9b184e",accent_color:"#e75761",font_family:"Inter",font_size:12,titulo_principal:"Painel de Gest√£o de Afiliadas - Aylle Duarte",subtitulo:"Acompanhe o desempenho dos seus afiliados em tempo real",empresa:"Aylle Duarte"};function Or(){const a="legacy-calendar-styles";if(document.getElementById(a))return;const r=document.createElement("style");r.id=a,r.textContent=`
    #legacy-calendar-overlay {
      --calendar-bg: rgba(255, 255, 255, 0.75);
      --calendar-text: #1e293b;
      --calendar-primary: #9b184e;
      --calendar-day-bg: #f1f5f9;
      --calendar-day-text: #475569;
      --calendar-menu-bg: #ffffff;
      --calendar-menu-hover: #f8fafc;
      --calendar-border: #e2e8f0;
      --calendar-shadow: rgba(155, 24, 78, 0.1);
      --modal-backdrop-bg: rgba(0, 0, 0, 0.4);
    }

    #legacy-calendar-overlay.dark {
      --calendar-bg: rgba(30, 41, 59, 0.75);
      --calendar-text: #f8fafc;
      --calendar-primary: #e75761;
      --calendar-day-bg: #334155;
      --calendar-day-text: #cbd5e1;
      --calendar-menu-bg: #1e293b;
      --calendar-menu-hover: #334155;
      --calendar-border: #334155;
      --calendar-shadow: rgba(231, 87, 97, 0.15);
      --modal-backdrop-bg: rgba(0, 0, 0, 0.6);
    }

    .gradient-bg { background: linear-gradient(135deg, #9b184e 0%, #e75761 100%); }
    .glass-effect {
      backdrop-filter: blur(12px);
      background: var(--calendar-bg);
      color: var(--calendar-text);
      border: 1px solid var(--calendar-border);
    }
    html.dark .glass-effect {
      background: rgba(30, 41, 59, 0.80);
      color: #f8fafc;
      border-color: #334155;
    }
    .card-shadow { box-shadow: 0 4px 20px var(--calendar-shadow); }
    .hover-lift { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 8px 30px rgba(155, 24, 78, 0.2); }
    .calendar-day { transition: all 0.2s ease; cursor: pointer; position: relative; }
    .calendar-day:hover { transform: scale(1.05); }
    .status-postou-vendas { background: linear-gradient(135deg, #059669, #10B981); color: white; }
    .status-postou { background: linear-gradient(135deg, #F59E0B, #FCD34D); color: white; }
    .status-nao-postou { background: linear-gradient(135deg, #EF4444, #F87171); color: white; }
    .status-sem-analise { background: linear-gradient(135deg, #6B7280, #9CA3AF); color: white; }
    .modal-backdrop { backdrop-filter: blur(8px); background: var(--modal-backdrop-bg); }
    .day-default-bg { background-color: var(--calendar-day-bg); color: var(--calendar-day-text); }
    .day-menu { background-color: var(--calendar-menu-bg); border-color: var(--calendar-border); }
    .day-menu-btn:hover { background-color: var(--calendar-menu-hover); }
    .close-btn:hover { background-color: var(--calendar-day-bg); }

    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeInUp 0.6s ease-out; }
  `,document.head.appendChild(r)}function qr(a,r){return new Date(r,a+1,0).getDate()}function Rr(a,r){return new Date(r,a,1).getDay()}function Br(a){const s=ut.getState().achievements||[],c=window.__awardedAchievements[a]||{},u=Object.entries(window.__calendarStatuses).filter(([d,y])=>d.startsWith(`${a}:`));for(const d of s){const y=`${window.currentYear}-${String(window.currentMonth+1).padStart(2,"0")}`,g=d.timeWindow==="month"?`${d.id}@${y}`:d.id;if(c[g])continue;const w=new Set(d.classKeys||[]),S=u.filter(([,C])=>w.has(C)).map(([C])=>new Date(C.split(":")[1])).sort((C,T)=>C.getTime()-T.getTime());if((d.streakDays||0)>0){let C=0,T=null;for(const O of S)if(T&&(O.getTime()-T.getTime())/864e5===1?C+=1:C=1,T=O,C>=(d.streakDays||0)){window.__awardedAchievements[a]={...c,[g]:!0},window.__affiliatePoints[a]=(window.__affiliatePoints[a]||0)+d.xp,window.onAchievementAwarded?.({affiliateId:a,achievementId:d.id,xp:d.xp,title:d.title});break}}(d.countThreshold||0)>0&&u.filter(([T,O])=>T.includes(`:${y}-`)).filter(([,T])=>w.has(T)).length>=(d.countThreshold||0)&&(window.__awardedAchievements[a]={...c,[g]:!0},window.__affiliatePoints[a]=(window.__affiliatePoints[a]||0)+d.xp,window.onAchievementAwarded?.({affiliateId:a,achievementId:d.id,xp:d.xp,title:d.title}))}}window.getStatusForDay=function(a,r,s,c){const u=`${a}:${c}-${String(s+1).padStart(2,"0")}-${String(r).padStart(2,"0")}`;return window.__calendarStatuses[u]||null};window.marcarDia=function(a,r){if(!window.selectedAfiliada)return;const s=`${window.selectedAfiliada.id}:${window.currentYear}-${String(window.currentMonth+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`,c=`${window.currentYear}-${String(window.currentMonth+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`;Vt(window.selectedAfiliada.id,c,r).then(u=>{if(!u)return;r?window.__calendarStatuses[s]=r:delete window.__calendarStatuses[s],Br(window.selectedAfiliada.id);const d=document.getElementById("legacy-calendar-root");d&&(d.innerHTML=window.renderCalendario()),window.dispatchEvent(new Event("focus"))})};window.toggleDayMenu=function(a){const r=document.getElementById(`day-menu-${a}`);if(!r)return;const s=r.classList.contains("hidden");document.querySelectorAll('[id^="day-menu-"]').forEach(c=>c.classList.add("hidden")),s&&r.classList.remove("hidden")};window.navegarMes=function(a){const r=a==="prev"?-1:1,s=new Date(window.currentYear,window.currentMonth+r,1);window.currentYear=s.getFullYear(),window.currentMonth=s.getMonth(),Xt(window.currentYear,window.currentMonth);const c=document.getElementById("legacy-calendar-root");c&&(c.innerHTML=window.renderCalendario())};window.fecharCalendario=function(){const a=document.getElementById("legacy-calendar-overlay");a&&a.remove(),window.themeObserver&&(window.themeObserver.disconnect(),window.themeObserver=null)};window.renderCalendario=function(){if(!window.selectedAfiliada)return"";Xt(window.currentYear,window.currentMonth);const r=(window.elementSdk?.config||window.defaultConfig).font_size||window.defaultConfig.font_size,s=qr(window.currentMonth,window.currentYear),c=Rr(window.currentMonth,window.currentYear),u=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],d=["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"],y=ut.getState().classes;let g=`
    <div class="fixed inset-0 modal-backdrop flex items-center justify-center z-50">
      <div class="max-w-xs w-full mx-4 glass-effect rounded-2xl p-3 card-shadow animate-fade-in" onclick="event.stopPropagation()">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h3 style="font-size: ${r*1.5}px; font-weight: 700; color: var(--calendar-primary);">üìÖ ${window.selectedAfiliada.nome}</h3>
            <p style="font-size: ${r*.9}px; opacity: 0.7;">Marque as postagens do m√™s</p>
          </div>
          <button onclick="fecharCalendario()" class="p-3 rounded-xl close-btn transition-all" style="font-size: ${r*1.2}px;">‚úï</button>
        </div>
        <div class="flex items-center justify-between mb-4">
          <button onclick="navegarMes('prev')" class="p-3 rounded-xl gradient-bg text-white hover-lift">‚Äπ</button>
          <h4 style="font-size: ${r*1.2}px; font-weight: 600;">${u[window.currentMonth]} ${window.currentYear}</h4>
          <button onclick="navegarMes('next')" class="p-3 rounded-xl gradient-bg text-white hover-lift">‚Ä∫</button>
        </div>
        <div class="grid grid-cols-7 gap-1 mb-2">
          ${d.map(w=>`
            <div class="text-center p-2" style="font-size: ${r*.8}px; font-weight: 600; opacity: 0.6;">${w}</div>
          `).join("")}
        </div>
        <div class="grid grid-cols-7 gap-1 mb-4">
  `;for(let w=0;w<c;w++)g+="<div></div>";for(let w=1;w<=s;w++){const S=window.getStatusForDay(window.selectedAfiliada.id,w,window.currentMonth,window.currentYear);let C="day-default-bg",T="";const O=new Date(window.currentYear,window.currentMonth,w).getDay(),X=O===0||O===6;if(S){const _=y.find(N=>N.key===S);_?.bgClass?C=_.bgClass:_?.bg&&(C="",T=_.bg)}else if(X){const _=y.find(N=>N.key==="sem_analise");_?.bgClass?C=_.bgClass:_?.bg?(C="",T=_.bg):C="status-sem-analise"}g+=`
      <div class="relative">
        <button onclick="toggleDayMenu(${w})" class="calendar-day w-full aspect-square rounded-xl flex items-center justify-center ${C}" style="${T?`background:${T}; color: white;`:""} font-size: ${r*.9}px; font-weight: 600;">
          ${w}
        </button>
        <div id="day-menu-${w}" class="absolute day-menu top-full left-0 mt-2 rounded-xl shadow-xl border z-20 hidden overflow-hidden" style="min-width: 160px;">
          ${y.map(_=>`
            <button onclick="marcarDia(${w}, '${_.key}')" class="w-full text-left px-4 py-3 day-menu-btn transition-all" style="font-size: ${r*.85}px;">
              ${_.label}
            </button>
          `).join("")}
          ${S?`<button onclick="marcarDia(${w}, null)" class="w-full text-left px-4 py-3 day-menu-btn border-t" style="border-color: var(--calendar-border); font-size: ${r*.85}px;">Limpar</button>`:""}
        </div>
      </div>
    `}return g+=`
        </div>
        <div class="grid grid-cols-2 gap-x-4 gap-y-2" style="font-size: ${r*.85}px;">
          ${y.map(w=>`
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 rounded-full ${w.bgClass||""}" style="${w.bg&&!w.bgClass?`background:${w.bg}`:""}"></span>
              <span>${w.label}</span>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `,g};window.openLegacyCalendar=function(a){Or(),window.selectedAfiliada=a,window.currentMonth=new Date().getMonth(),window.currentYear=new Date().getFullYear();const r=document.createElement("div");r.id="legacy-calendar-overlay",r.className="fixed inset-0 z-50";const s=document.createElement("div");s.id="legacy-calendar-root",s.innerHTML=window.renderCalendario(),r.appendChild(s),document.body.appendChild(r);const c=()=>{document.documentElement.classList.contains("dark")?r.classList.add("dark"):r.classList.remove("dark")};c();const u=new MutationObserver(c);u.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),window.themeObserver=u,r.addEventListener("click",d=>{d.target===r&&window.fecharCalendario()})};async function Xt(a,r){const s=`${a}-${String(r+1).padStart(2,"0")}`;if(window.__loadedMonths[s])return;const c=await mt(a,r);window.__calendarStatuses={...window.__calendarStatuses,...c},window.__loadedMonths[s]=!0}const Ke="dashboard_banner",ye={title:"Painel de Gest√£o de Afiliados -",description:"Acompanhe o desempenho dos seus afiliados em tempo real",gradientFrom:"from-primary",gradientVia:"via-secondary",gradientTo:"to-accent"},Ur="Painel de Gest√£o de Afiliados - Aylle Duarte";function zr(){try{if(typeof window>"u")return null;const a=window.localStorage?.getItem("banner-storage");if(!a)return null;const s=JSON.parse(a)?.state?.config;return!s||typeof s!="object"||typeof s.title!="string"||!s.title.trim()?null:{title:String(s.title),description:typeof s.description=="string"?s.description:ye.description,gradientFrom:typeof s.gradientFrom=="string"?s.gradientFrom:ye.gradientFrom,gradientVia:typeof s.gradientVia=="string"?s.gradientVia:ye.gradientVia,gradientTo:typeof s.gradientTo=="string"?s.gradientTo:ye.gradientTo}}catch{return null}}async function Yt(a){const{data:r,error:s}=await $.from("user_settings").select("settings").eq("user_id",a).maybeSingle();return s?{settings:null,error:s}:{settings:r?.settings||null,error:null}}async function ct(a,r){return await Wt(a)?$.from("user_settings").upsert({user_id:a,settings:r,updated_at:new Date().toISOString()},{onConflict:"user_id"}):(A.error("Esta funcionalidade n√£o est√° dispon√≠vel no seu plano atual."),{data:null,error:{message:"forbidden"}})}const Yr=mr()((a,r)=>({config:ye,initializeFromSupabase:async()=>{const s=await _t();if(!s)return;const{settings:c,error:u}=await Yt(s);if(u)return;const d=c||{},y=d?.[Ke];if(y&&typeof y=="object"){const T={...ye,...y};if(a({config:T}),!y.title||typeof y.title!="string"||!y.title.trim()){const O={...d,[Ke]:T};await ct(s,O)}return}const g=zr(),S=g&&typeof g.title=="string"&&g.title.trim()&&g.title!==Ur?g:ye;a({config:S});const C={...d,[Ke]:S};await ct(s,C)},updateConfig:async s=>{const c={...r().config,...s};a({config:c});const u=await _t();if(!u)return;const{settings:d}=await Yt(u),g={...d||{},[Ke]:c};await ct(u,g)}}));function Wr({isOpen:a,onClose:r,affiliate:s,calendarStatuses:c,classes:u,onSetStatus:d}){const y=x.useRef(null),[g,w]=x.useState({month:new Date().getMonth(),year:new Date().getFullYear(),date:new Date().getDate(),monthformat:"full",highlighttoday:!0,highlighttargetdate:!1,prevnextbutton:"show",todaybutton:"show"}),S=x.useRef(g),[C,T]=x.useState(null),[O,X]=x.useState(!1);return x.useEffect(()=>{S.current=g},[g]),x.useEffect(()=>{a||(T(null),X(!1))},[a]),x.useEffect(()=>{if(!a||!y.current)return;const _={full:["January","February","March","April","May","June","July","August","September","October","November","December"],mmm:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},N={d:["S","M","T","W","T","F","S"]},R=i=>String(i).padStart(2,"0");function H(i,o,h){const l=new Date,f={};return f.today={date:l.getDate(),monthIndex:l.getMonth(),year:l.getFullYear()},l.setFullYear(i),l.setMonth(o),l.setDate(1),f.firstDayIndex=l.getDay(),f.monthIndex=o,f.year=i,l.setMonth(o+1),l.setDate(0),f.totaldays=l.getDate(),f}function B(i,o){const h=document.createElement("table");let l=document.createElement("tr");for(let b=0;b<=6;b++){const P=document.createElement("td");P.innerHTML=N.d[b],l.appendChild(P)}h.appendChild(l),l=document.createElement("tr");let f=0;for(;f<i.firstDayIndex;f++){const b=document.createElement("td");l.appendChild(b)}let j=1;for(;f<=6;){const b=document.createElement("td");b.innerHTML=String(j),J(b,j,i.monthIndex,i.year,o,i),l.appendChild(b),j++,f++}h.appendChild(l);for(let b=3;b<=7&&!(j>i.totaldays);b++){l=document.createElement("tr");for(let P=0;P<=6&&!(j>i.totaldays);P++){const ee=document.createElement("td");ee.innerHTML=String(j),J(ee,j,i.monthIndex,i.year,o,i),l.appendChild(ee),j++}h.appendChild(l)}return h}function J(i,o,h,l,f,j){if(f.highlighttoday&&j.today.date===o&&j.today.monthIndex===j.monthIndex&&i.classList.add("dycalendar-today-date"),f.highlighttargetdate&&f.date===o&&j.monthIndex===f.month&&i.classList.add("dycalendar-target-date"),s&&c&&u){const b=`${l}-${R(h+1)}-${R(o)}`,P=`${s.id}:${b}`,ee=c[P];if(ee){const ie=u.find(rt=>rt.key===ee);ie&&(i.style.background=ie.bg||"#ccc",i.style.color=ie.textColor||"#fff",i.title=`${ie.label} (${ie.points} pts)`)}}}function oe(i,o){const h=document.createElement("div");h.className="dycalendar-month-container";const l=document.createElement("div");if(l.className="dycalendar-header",l.setAttribute("data-option",JSON.stringify(o)),o.prevnextbutton==="show"){const b=document.createElement("span");b.className="dycalendar-prev-next-btn prev-btn",b.setAttribute("data-btn","prev"),b.textContent="<",l.appendChild(b)}const f=document.createElement("span");if(f.className="dycalendar-span-month-year",f.textContent=o.monthformat==="full"?_.full[i.monthIndex]+" "+i.year:_.mmm[i.monthIndex]+" "+i.year,l.appendChild(f),o.prevnextbutton==="show"){const b=document.createElement("span");b.className="dycalendar-prev-next-btn next-btn",b.setAttribute("data-btn","next"),b.textContent=">",l.appendChild(b)}if(h.appendChild(l),o.todaybutton==="show"){const b=document.createElement("div");b.className="dycalendar-today-btn";const P=document.createElement("span");P.className="today-btn",P.setAttribute("data-btn","today"),P.textContent="Today",b.appendChild(P),h.appendChild(b)}const j=document.createElement("div");return j.className="dycalendar-body",j.appendChild(B(i,o)),h.appendChild(j),h}function I(i){const o=H(i.year,i.month,i.date),h=oe(o,i),l=y.current;l.innerHTML="",l.appendChild(h)}const p=y.current,D=i=>{const o=i.target;if(o.classList.contains("dycalendar-prev-next-btn")){const h=S.current,f=o.getAttribute("data-btn")==="prev"?-1:1,j=new Date(h.year,h.month+f,1),b={...h,month:j.getMonth(),year:j.getFullYear()};w(b),I(b);return}if(o.classList.contains("today-btn")){const h=S.current,l=new Date,f={...h,date:l.getDate(),month:l.getMonth(),year:l.getFullYear()};w(f),I(f);return}if(o.tagName==="TD"&&o.innerHTML){const h=S.current,l=Number(o.innerHTML);if(!Number.isFinite(l)||l<=0)return;const f={...h,highlighttargetdate:!0,date:l};w(f);const j=`${h.year}-${R(h.month+1)}-${R(l)}`;T(j),I(f)}};return p.addEventListener("click",D),I(S.current),()=>{p.removeEventListener("click",D)}},[a,s,c,u]),x.useEffect(()=>{if(!a||!y.current)return;const _={full:["January","February","March","April","May","June","July","August","September","October","November","December"],mmm:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},N={d:["S","M","T","W","T","F","S"]},R=p=>String(p).padStart(2,"0");function H(p,D,i){const o=new Date,h={};return h.today={date:o.getDate(),monthIndex:o.getMonth(),year:o.getFullYear()},o.setFullYear(p),o.setMonth(D),o.setDate(1),h.firstDayIndex=o.getDay(),h.monthIndex=D,h.year=p,o.setMonth(D+1),o.setDate(0),h.totaldays=o.getDate(),h}function B(p,D,i,o,h,l){if(h.highlighttoday&&l.today.date===D&&l.today.monthIndex===l.monthIndex&&p.classList.add("dycalendar-today-date"),h.highlighttargetdate&&h.date===D&&l.monthIndex===h.month&&p.classList.add("dycalendar-target-date"),s&&c&&u){const f=`${o}-${R(i+1)}-${R(D)}`,j=`${s.id}:${f}`,b=c[j];if(b){const P=u.find(ee=>ee.key===b);P&&(p.style.background=P.bg||"#ccc",p.style.color=P.textColor||"#fff",p.title=`${P.label} (${P.points} pts)`)}}}function J(p,D){const i=document.createElement("table");let o=document.createElement("tr");for(let f=0;f<=6;f++){const j=document.createElement("td");j.innerHTML=N.d[f],o.appendChild(j)}i.appendChild(o),o=document.createElement("tr");let h=0;for(;h<p.firstDayIndex;h++){const f=document.createElement("td");o.appendChild(f)}let l=1;for(;h<=6;){const f=document.createElement("td");f.innerHTML=String(l),B(f,l,p.monthIndex,p.year,D,p),o.appendChild(f),l++,h++}i.appendChild(o);for(let f=3;f<=7&&!(l>p.totaldays);f++){o=document.createElement("tr");for(let j=0;j<=6&&!(l>p.totaldays);j++){const b=document.createElement("td");b.innerHTML=String(l),B(b,l,p.monthIndex,p.year,D,p),o.appendChild(b),l++}i.appendChild(o)}return i}function oe(p,D){const i=document.createElement("div");i.className="dycalendar-month-container";const o=document.createElement("div");if(o.className="dycalendar-header",o.setAttribute("data-option",JSON.stringify(D)),D.prevnextbutton==="show"){const f=document.createElement("span");f.className="dycalendar-prev-next-btn prev-btn",f.setAttribute("data-btn","prev"),f.textContent="<",o.appendChild(f)}const h=document.createElement("span");if(h.className="dycalendar-span-month-year",h.textContent=D.monthformat==="full"?_.full[p.monthIndex]+" "+p.year:_.mmm[p.monthIndex]+" "+p.year,o.appendChild(h),D.prevnextbutton==="show"){const f=document.createElement("span");f.className="dycalendar-prev-next-btn next-btn",f.setAttribute("data-btn","next"),f.textContent=">",o.appendChild(f)}if(i.appendChild(o),D.todaybutton==="show"){const f=document.createElement("div");f.className="dycalendar-today-btn";const j=document.createElement("span");j.className="today-btn",j.setAttribute("data-btn","today"),j.textContent="Today",f.appendChild(j),i.appendChild(f)}const l=document.createElement("div");return l.className="dycalendar-body",l.appendChild(J(p,D)),i.appendChild(l),i}function I(p){const D=H(p.year,p.month,p.date),i=oe(D,p),o=y.current;o.innerHTML="",o.appendChild(i)}I(S.current)},[a,g,s,c,u]),a?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"rounded-2xl shadow-xl w-full max-w-md mx-auto p-6 relative",style:{background:"linear-gradient(135deg, #9b184e 0%, #e75761 100%)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center bg-white rounded-lg",children:e.jsx(Ae,{className:"w-5 h-5 text-[#e75761]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:s?.name}),e.jsxs("div",{className:"flex items-center gap-2 text-white/90 text-sm",children:[e.jsxs("span",{children:[s?.points||0," pts"]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:s?.level||"Iniciante"})]})]})]}),e.jsx("button",{onClick:r,className:"text-white hover:text-white/90 transition-colors",children:e.jsx(ur,{className:"w-5 h-5"})})]}),e.jsx("div",{id:"dycalendar",ref:y,className:"bg-white/10 rounded-xl p-4"}),e.jsxs("div",{className:"mt-4 bg-white/10 rounded-xl p-4",children:[e.jsx("div",{className:"text-white/90 text-sm font-medium mb-3",children:C?`Dia selecionado: ${C}`:"Selecione um dia no calend√°rio"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(u||[]).map(_=>e.jsxs("button",{type:"button",disabled:!C||O,onClick:async()=>{if(!(!s?.id||!C)&&typeof d=="function"){X(!0);try{await d(s.id,C,_.key)}finally{X(!1)}}},className:`px-3 py-2 rounded-lg text-xs font-semibold transition-opacity ${!C||O?"opacity-50":"opacity-100"}`,style:{background:_.bg||"#fff",color:_.textColor||"#111"},title:_.description||_.label,children:[_.label," (",_.points," pts)"]},_.key)),e.jsx("button",{type:"button",disabled:!C||O,onClick:async()=>{if(!(!s?.id||!C)&&typeof d=="function"){X(!0);try{await d(s.id,C,null)}finally{X(!1)}}},className:`px-3 py-2 rounded-lg text-xs font-semibold bg-white text-black transition-opacity ${!C||O?"opacity-50":"opacity-100"}`,children:"Limpar"})]})]}),e.jsx("style",{children:`
          #dycalendar table { width: 100%; border-spacing: 8px; }
          #dycalendar table tr:nth-child(1) td { background: #fff; color: #111; border-radius: 4px; font-weight: 600; }
          #dycalendar table td { color: #fff; padding: 10px; cursor: pointer; border-radius: 4px; }
          #dycalendar table td:hover { background: #fff; color: #111 !important; }
          .dycalendar-today-date, .dycalendar-target-date { background: #fff !important; color: #111 !important; border-radius: 8px; }
          .dycalendar-prev-next-btn.prev-btn, .dycalendar-prev-next-btn.next-btn { background: #fff; color: #111; width: 44px; height: 38px; border-radius: 4px; font-size: 24px; display: flex; align-items: center; justify-content: center; }
          .dycalendar-span-month-year { color: #fff; font-size: 1.5em; font-weight: 500; }
          .dycalendar-today-btn .today-btn { background: #fff; color: #111; border-radius: 4px; padding: 5px; cursor: pointer; }
          .dycalendar-header, .dycalendar-body, .dycalendar-today-btn { display: flex; align-items: center; justify-content: center; gap: 12px; }
          .dycalendar-month-container { display: flex; flex-direction: column; gap: 10px; }
        `})]})}):null}function Vr(){const a=xr(),r=hr(),[s,c]=x.useState("dashboard"),[u,d]=x.useState("grid"),[y,g]=x.useState(!1),[w,S]=x.useState(null),[C,T]=x.useState(""),[O,X]=x.useState(new Date().getMonth()),[_,N]=x.useState(new Date().getFullYear()),[R,H]=x.useState(new Date().getMonth()),[B,J]=x.useState(new Date().getFullYear()),[oe,I]=x.useState([]),p=x.useRef([]),D=x.useRef({}),i=x.useRef({}),{config:o,updateConfig:h,initializeFromSupabase:l}=Yr(),[f,j]=x.useState(!1),[b,P]=x.useState(o),[ee,ie]=x.useState(!1);x.useEffect(()=>{f&&P(o)},[f,o]);const rt=async()=>{if(r&&!r.canUseTool("dashboard-banner-save")){r.notifyToolBlocked();return}await h(b),j(!1),A.success("Banner atualizado com sucesso!")};x.useEffect(()=>{l()},[l]);const{classes:Q,levels:te,achievements:re,initializeFromSupabase:ft}=ut(),{subscription:Ht}=gr(),{startDashboardTutorial:Jt}=pr(),Re=!Ht,[me,Be]=x.useState(null),ge=x.useCallback(t=>{let n=te[0],m=te[te.length-1];for(let v=0;v<te.length;v++)t>=te[v].minXP&&(n=te[v],v<te.length-1?m=te[v+1]:m={...te[v],minXP:te[v].minXP*1.5});const k=Math.min(100,Math.max(0,(t-n.minXP)/(m.minXP-n.minXP)*100));return{currentLevel:n,nextLevel:m,progress:k}},[te]);x.useEffect(()=>{ft()},[ft]),x.useEffect(()=>{(async()=>{try{const{data:n,error:m}=await $.from("app_settings").select("value").eq("key","billing_settings").maybeSingle();if(m){Be(null);return}const k=n?.value;typeof k?.free_usage_limit=="number"?Be(k.free_usage_limit):Be(null)}catch{Be(null)}})()},[]);const[K,Gt]=x.useState([]),[Qt,xt]=x.useState([]),[Kt,ht]=x.useState({}),[Xr,Zt]=x.useState({}),[at,er]=x.useState(""),[tr,Ue]=x.useState(!1),[st,gt]=x.useState(!1),[ue,De]=x.useState(!1),je=x.useRef(null),le=x.useRef(null),nt=x.useRef(null),pt=K.filter(t=>{if(!at.trim())return!0;const n=at.toLowerCase();return(t.name||"").toLowerCase().includes(n)||(t.username||"").toLowerCase().includes(n)}),bt=x.useCallback((t,n,m)=>{const k=`${_}-${String(O+1).padStart(2,"0")}`;return t.map(v=>{const E=v.id,F=typeof v.instagram=="string"?v.instagram.trim():"",Y=F?F.startsWith("@")?F:`@${F}`:"",q=Object.entries(n).filter(([U])=>U.startsWith(`${E}:`)).filter(([U])=>U.includes(`:${k}-`)),se=q.filter(([,U])=>Q.find(M=>M.key===U)?.type==="positive").length,G=q.filter(([,U])=>Q.find(M=>M.key===U)?.type==="negative").length,V=q.filter(([,U])=>U==="sem_analise").length,Z=q.filter(([,U])=>U==="postou_vendas").length,ke=q.reduce((U,[,L])=>{const M=Q.find(z=>z.key===L);return U+(M?.points||0)},0),Ce=m[E]||{},Te=re.filter(U=>Object.keys(Ce).some(L=>L===U.id||L.startsWith(`${U.id}@`))),Le=re.reduce((U,L)=>{const M=Object.keys(Ce).filter(z=>z===L.id||z.startsWith(`${L.id}@`)).length;return U+M*L.xp},0),_e=ke+Le,we=se+G,ve=we>0?Math.round(se/we*100):0,{currentLevel:Se}=ge(_e);return{id:E,name:v.name,username:Y,points:_e,level:Se.name,performance:ve,posted:se,notPosted:G,noAnalysis:V,salesPosts:Z,instagramLink:v.instagram_link,notes:v.notes,myAchievements:Te}})},[_,O,Q,re,ge]),ne=x.useCallback((t,n,m)=>{const k={...m};t.forEach(E=>{const F=Tt(E.id,re,n);k[E.id]={...k[E.id]||{},...F}});const v=bt(t,n,k);Gt(v)},[bt,re]);x.useEffect(()=>{p.current.length>0&&ne(p.current,D.current,i.current)},[re,ne]);const pe=x.useCallback(t=>{xt(n=>{const m=t(n);return p.current=m,ne(m,D.current,i.current),m})},[ne]),be=x.useCallback(async()=>{try{const t=await Bt();xt(t),p.current=t,ne(t,D.current,i.current)}catch(t){console.error("Error loading affiliates:",t)}},[ne]),fe=x.useCallback(async()=>{try{const[t,n,m]=await Promise.all([Ut(),mt(_,O),zt()]),k={...t,...n};window.__calendarStatuses=k,window.__awardedAchievements=m,ht(k),Zt(m),D.current=k,i.current=m,ne(p.current,k,m)}catch(t){console.error("Error loading metrics:",t)}},[_,O,ne]),ze=x.useCallback(async()=>{await Promise.all([be(),fe()])},[be,fe]),rr=async()=>{if(r&&!r.canUseTool("dashboard-month-clear")){r.notifyToolBlocked();return}if(Re&&typeof me=="number"){const n=Math.max(0,me);if(n>0&&K.length>=n){A.error("Limite do plano Free atingido. Fa√ßa upgrade para continuar."),a("/dashboard/settings");return}}gt(!0),await Pr(_,O)?(A.success("Dados do m√™s apagados com sucesso"),Ue(!1),await fe()):A.error("Erro ao apagar dados do m√™s"),gt(!1)};x.useEffect(()=>{be()},[be]),x.useEffect(()=>{fe()},[fe]),x.useEffect(()=>{let t,n=!1,m=null,k=0;const v=()=>{if(n)return;m!==null&&window.clearTimeout(m);const F=Math.min(3e4,1e3*Math.pow(2,k));k=Math.min(6,k+1),m=window.setTimeout(()=>{E()},F)},E=async()=>{const F=await he();n||!F||(t&&($.removeChannel(t),t=null),t=$.channel(`realtime:affiliates:${F.id}`).on("postgres_changes",{event:"*",schema:"public",table:"affiliates",filter:`owner_user_id=eq.${F.id}`},Y=>{const ce=Y?.eventType,q=Y?.new,se=Y?.old;if(ce==="DELETE"){const G=se?.id;G&&pe(V=>V.filter(Z=>Z?.id!==G));return}if(q?.id){if(q.status&&q.status!=="active"){pe(G=>G.filter(V=>V?.id!==q.id));return}pe(G=>{const V=G.findIndex(Z=>Z?.id===q.id);if(V>=0){const Z=[...G];return Z[V]={...G[V],...q},Z}return[q,...G]})}}).subscribe(Y=>{if(!n){if(Y==="SUBSCRIBED"){k=0,m!==null&&(window.clearTimeout(m),m=null);return}(Y==="CHANNEL_ERROR"||Y==="TIMED_OUT"||Y==="CLOSED")&&v()}}))};return nt.current=()=>{n||(k=0,m!==null&&(window.clearTimeout(m),m=null),E())},E(),()=>{n=!0,nt.current=null,m!==null&&(window.clearTimeout(m),m=null),t&&$.removeChannel(t)}},[pe]),x.useEffect(()=>{if(!ue)return;let t=0;const n=()=>{const m=je.current;if(typeof m!="number")return;if(Date.now()-m>15e3){try{le.current?.abort()}catch{}le.current=null,je.current=null,De(!1),be();return}t=window.requestAnimationFrame(n)};return t=window.requestAnimationFrame(n),()=>window.cancelAnimationFrame(t)},[ue,be]),x.useEffect(()=>{const t=()=>{if(document.visibilityState==="visible"){if(ue){try{le.current?.abort()}catch{}le.current=null,je.current=null,De(!1)}try{$?.realtime?.connect?.()}catch{}try{$?.auth?.refreshSession?.()}catch{}nt.current?.(),ze()}},n=()=>{if(ue){try{le.current?.abort()}catch{}le.current=null,je.current=null,De(!1)}},m=()=>fe(),k=()=>fe();return window.addEventListener("focus",t),document.addEventListener("visibilitychange",t),window.addEventListener("online",t),window.addEventListener("pageshow",t),window.addEventListener("resume",t),window.addEventListener("freeze",n),window.addEventListener("pagehide",n),window.addEventListener("achievement-awarded",m),window.addEventListener("calendar-status-updated",k),()=>{window.removeEventListener("focus",t),document.removeEventListener("visibilitychange",t),window.removeEventListener("online",t),window.removeEventListener("pageshow",t),window.removeEventListener("resume",t),window.removeEventListener("freeze",n),window.removeEventListener("pagehide",n),window.removeEventListener("achievement-awarded",m),window.removeEventListener("calendar-status-updated",k)}},[ze,fe,ue]);const[de,$e]=x.useState({nome:"",instagram:"",link:"",observacoes:""}),wt=t=>{const n=t==="prev"?-1:1,m=new Date(B,R+n,1);J(m.getFullYear()),H(m.getMonth())},ar=new Date(B,R,1).toLocaleString("pt-BR",{month:"long"}),Me=x.useCallback(async()=>{try{const[t,n,m,k]=await Promise.all([Bt(),Ut(),mt(B,R),zt()]),v={...n,...m},E=`${B}-${String(R+1).padStart(2,"0")}`,F=t.map(Y=>{const ce=Y.id,q=typeof Y.instagram=="string"?Y.instagram.trim():"",se=q?q.startsWith("@")?q:`@${q}`:"",V=Object.entries(v).filter(([M])=>M.startsWith(`${ce}:`)).filter(([M])=>M.includes(`:${E}-`)),Z=V.filter(([,M])=>Q.find(ae=>ae.key===M)?.type==="positive").length,ke=V.filter(([,M])=>Q.find(ae=>ae.key===M)?.type==="negative").length,Ce=V.filter(([,M])=>M==="sem_analise").length,Te=V.filter(([,M])=>M==="postou_vendas").length,Le=V.reduce((M,[,z])=>{const ae=Q.find(He=>He.key===z);return M+(ae?.points||0)},0),_e=k[ce]||{},we=re.reduce((M,z)=>{const ae=Object.keys(_e).filter(He=>He===z.id||He.startsWith(`${z.id}@`)).length;return M+ae*z.xp},0),ve=Le+we,Se=Z+ke,U=Se>0?Math.round(Z/Se*100):0,{currentLevel:L}=ge(ve);return{id:ce,name:Y.name,username:se,points:ve,level:L.name,performance:U,posted:Z,notPosted:ke,noAnalysis:Ce,salesPosts:Te}});I(F)}catch(t){console.error("Error refreshing metrics data:",t)}},[B,R,Q,re,ge]);x.useEffect(()=>{Me()},[Me]);const vt=new Date(_,O,1).toLocaleString("pt-BR",{month:"long"}),yt=x.useCallback(t=>{const n=`${B}-${String(R+1).padStart(2,"0")}`,k=(p.current||[]).map(v=>{const E=v.id,F=typeof v.instagram=="string"?v.instagram.trim():"",Y=F?F.startsWith("@")?F:`@${F}`:"",q=Object.entries(t).filter(([L])=>L.startsWith(`${E}:`)).filter(([L])=>L.includes(`:${n}-`)),se=q.filter(([,L])=>Q.find(z=>z.key===L)?.type==="positive").length,G=q.filter(([,L])=>Q.find(z=>z.key===L)?.type==="negative").length,V=q.filter(([,L])=>L==="sem_analise").length,Z=q.filter(([,L])=>L==="postou_vendas").length,ke=q.reduce((L,[,M])=>{const z=Q.find(ae=>ae.key===M);return L+(z?.points||0)},0),Ce=i.current[E]||{},Te=Tt(E,re,t),Le={...Ce,...Te},_e=re.reduce((L,M)=>{const z=Object.keys(Le).filter(ae=>ae===M.id||ae.startsWith(`${M.id}@`)).length;return L+z*M.xp},0),we=ke+_e,ve=se+G,Se=ve>0?Math.round(se/ve*100):0,{currentLevel:U}=ge(we);return{id:E,name:v.name,username:Y,points:we,level:U.name,performance:Se,posted:se,notPosted:G,noAnalysis:V,salesPosts:Z}});I(k)},[B,R,Q,re,ge]),Ye=t=>{S(t),g(!0)},sr=x.useCallback(async(t,n,m)=>await Vt(t,n,m)?(ht(v=>{const E={...v},F=`${t}:${n}`;return m?E[F]=m:delete E[F],window.__calendarStatuses=E,D.current=E,ne(p.current,E,i.current),yt(E),E}),!0):!1,[ne,yt]),nr=async()=>{if(r&&!r.canUseTool("dashboard-affiliate-add")){r.notifyToolBlocked();return}const{nome:t,instagram:n,link:m,observacoes:k}=de;if(!t.trim()){A("Preencha o nome");return}if(Re&&typeof me=="number"){const E=Math.max(0,me);if(E>0&&K.length>=E){A.error("Limite do plano Free atingido. Fa√ßa upgrade para continuar."),a("/dashboard/settings");return}}if(ue)return;try{le.current?.abort()}catch{}const v=new AbortController;le.current=v,je.current=Date.now(),De(!0);try{const E=n.trim(),F=await Lr(t.trim(),E||null,m.trim(),k?.trim(),{signal:v.signal});F&&($e({nome:"",instagram:"",link:"",observacoes:""}),A.success("Afiliada adicionada com sucesso"),pe(Y=>[F,...Y.filter(ce=>ce?.id!==F.id)]),s==="metricas"&&Me()),ze()}catch(E){(E instanceof Error?E.message:String(E)).toLowerCase().includes("abort")?be():(console.error("Error adding affiliate:",E),A.error("Erro ao adicionar afiliada. Tente novamente."))}finally{je.current=null,le.current=null,De(!1)}},[or,We]=x.useState(!1),[Ve,jt]=x.useState(null),Nt=t=>{jt({id:t.id,name:t.name}),We(!0)},ir=async()=>{if(!Ve)return;if(r&&!r.canUseTool("dashboard-affiliate-delete")){r.notifyToolBlocked();return}if(Re&&typeof me=="number"){const n=Math.max(0,me);if(n>0&&K.length>=n){A.error("Limite do plano Free atingido. Fa√ßa upgrade para continuar."),a("/dashboard/settings");return}}await Fr(Ve.id)&&(A.success("Afiliada removida com sucesso"),We(!1),jt(null),pe(n=>n.filter(m=>m?.id!==Ve.id)),s==="metricas"&&await Me())},[lr,Xe]=x.useState(!1),[W,Ne]=x.useState(null),kt=t=>{Ne({...t,instagram:t.username.replace("@","")}),Xe(!0)},dr=async()=>{if(!W)return;if(r&&!r.canUseTool("dashboard-affiliate-save")){r.notifyToolBlocked();return}if(Re&&typeof me=="number"){const k=Math.max(0,me);if(k>0&&K.length>=k){A.error("Limite do plano Free atingido. Fa√ßa upgrade para continuar."),a("/dashboard/settings");return}}const t=String(W.name||"").trim(),n=String(W.instagram||"").trim();if(!t){A.error("Preencha o nome");return}await Ir(W.id,{name:t,instagram:n||null,instagram_link:W.instagramLink,notes:W.notes})&&(A.success("Afiliada atualizada com sucesso"),Xe(!1),Ne(null),pe(k=>k.map(v=>v?.id===W.id?{...v,name:t,instagram:n||null,instagram_link:W.instagramLink,notes:W.notes}:v)),s==="metricas"&&await Me())},Ct=t=>{const n=t==="prev"?-1:1,m=new Date(_,O+n,1);N(m.getFullYear()),X(m.getMonth())};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-background",children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${o.gradientFrom} ${o.gradientVia} ${o.gradientTo} opacity-10`}),e.jsx("div",{className:"glass-card border-b border-border/50 backdrop-blur-xl",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12",children:e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-3 animate-fade-in",id:"dashboard-banner",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-primary/10 border border-primary/20",children:e.jsx(Ft,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-foreground",children:o.title}),e.jsx("button",{onClick:()=>j(!0),className:"p-2 rounded-xl hover:bg-muted text-muted-foreground hover:text-primary transition-colors",title:"Editar Banner",children:e.jsx(Qe,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mt-1",children:o.description})]})]})})})})]}),e.jsx(Ie,{open:f,onOpenChange:j,children:e.jsxs(Fe,{className:"w-[95vw] sm:w-full max-w-lg bg-background/90 backdrop-blur-2xl border-none shadow-2xl rounded-3xl p-0 overflow-hidden",children:[e.jsx(Pe,{className:"sr-only",children:"Personalizar Banner"}),e.jsxs("div",{className:`relative h-32 bg-gradient-to-br ${b.gradientFrom} ${b.gradientVia} ${b.gradientTo}`,children:[e.jsx("div",{className:"absolute inset-0 bg-background/40 backdrop-blur-[2px]"}),e.jsxs("div",{className:"absolute bottom-6 left-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Personalizar Banner"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Edite o t√≠tulo e visual do painel"})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",children:"T√≠tulo do Painel"}),e.jsx("div",{className:"relative group",children:e.jsx("input",{value:b.title,onChange:t=>P({...b,title:t.target.value}),className:"w-full bg-muted/50 border-2 border-transparent focus:border-primary/50 rounded-2xl px-4 py-3 outline-none transition-all duration-300 hover:bg-muted font-medium",placeholder:"Ex: Painel de Gest√£o"})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",children:"Descri√ß√£o"}),e.jsx("div",{className:"relative group",children:e.jsx("input",{value:b.description,onChange:t=>P({...b,description:t.target.value}),className:"w-full bg-muted/50 border-2 border-transparent focus:border-primary/50 rounded-2xl px-4 py-3 outline-none transition-all duration-300 hover:bg-muted font-medium",placeholder:"Ex: Acompanhe o desempenho..."})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",children:"Estilo do Gradiente"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{from:"from-primary",via:"via-secondary",to:"to-accent",label:"Neon"},{from:"from-blue-500",via:"via-cyan-500",to:"to-teal-500",label:"Ocean"},{from:"from-purple-500",via:"via-pink-500",to:"to-red-500",label:"Sunset"},{from:"from-green-500",via:"via-emerald-500",to:"to-lime-500",label:"Nature"},{from:"from-yellow-500",via:"via-orange-500",to:"to-red-500",label:"Fire"},{from:"from-gray-500",via:"via-gray-400",to:"to-gray-300",label:"Mono"}].map((t,n)=>e.jsx("button",{onClick:()=>P({...b,gradientFrom:t.from,gradientVia:t.via,gradientTo:t.to}),className:`h-12 rounded-xl bg-gradient-to-r ${t.from} ${t.via} ${t.to} opacity-80 hover:opacity-100 transition-all duration-300 ring-2 ring-offset-2 ring-offset-background ${b.gradientFrom===t.from?"ring-primary scale-105":"ring-transparent hover:scale-105"}`,title:t.label},n))})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>j(!1),className:"flex-1 px-6 py-3 rounded-xl font-medium text-muted-foreground hover:bg-gray-100 dark:hover:bg-white/5 transition-colors duration-300",children:"Cancelar"}),e.jsx("button",{onClick:rt,className:"flex-[2] px-6 py-3 rounded-xl font-bold bg-gradient-to-r from-primary to-secondary text-white shadow-lg shadow-primary/25 hover:shadow-primary/40 hover:scale-[1.02] active:scale-[0.98] transition-all duration-300",children:"Salvar Altera√ß√µes"})]})]})]})}),e.jsx(Ie,{open:or,onOpenChange:We,children:e.jsxs(Fe,{className:"w-[95vw] sm:w-full max-w-md bg-white/90 dark:bg-black/90 backdrop-blur-2xl border-none shadow-2xl rounded-3xl p-0 overflow-hidden",children:[e.jsx(Pe,{className:"sr-only",children:"Remover Afiliado"}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(Oe,{className:"w-8 h-8 text-destructive"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:"Remover Afiliado?"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-6",children:["Tem certeza que deseja remover ",e.jsx("strong",{children:Ve?.name}),"? Esta a√ß√£o n√£o pode ser desfeita e todos os dados ser√£o perdidos."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>We(!1),className:"flex-1 px-4 py-3 rounded-xl font-medium text-muted-foreground hover:bg-muted transition-colors duration-300",children:"Cancelar"}),e.jsx("button",{onClick:ir,className:"flex-1 px-4 py-3 rounded-xl font-bold bg-destructive text-white shadow-lg shadow-destructive/25 hover:shadow-destructive/40 hover:scale-[1.02] active:scale-[0.98] transition-all duration-300",children:"Sim, Remover"})]})]})]})}),e.jsx(Ie,{open:tr,onOpenChange:Ue,children:e.jsxs(Fe,{className:"w-[95vw] sm:w-full max-w-md bg-white/90 dark:bg-black/90 backdrop-blur-2xl border-none shadow-2xl rounded-3xl p-0 overflow-hidden",children:[e.jsx(Pe,{className:"sr-only",children:"Apagar dados do m√™s"}),e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(Oe,{className:"w-8 h-8 text-destructive"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:"Apagar dados do m√™s?"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-6",children:["Esta a√ß√£o remove todos os registros de todas as afiliadas para ",vt," de ",_,". Esta opera√ß√£o n√£o pode ser desfeita."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Ue(!1),className:"flex-1 px-4 py-3 rounded-xl font-medium text-muted-foreground hover:bg-muted transition-colors duration-300",disabled:st,children:"Cancelar"}),e.jsx("button",{onClick:rr,className:"flex-1 px-4 py-3 rounded-xl font-bold bg-destructive text-white shadow-lg shadow-destructive/25 hover:shadow-destructive/40 hover:scale-[1.02] active:scale-[0.98] transition-all duration-300 disabled:opacity-60 disabled:hover:scale-100",disabled:st,children:st?"Apagando...":"Sim, apagar"})]})]})]})}),e.jsx(Ie,{open:lr,onOpenChange:Xe,children:e.jsxs(Fe,{className:"w-[95vw] sm:w-full max-w-lg bg-white/90 dark:bg-black/90 backdrop-blur-2xl border-none shadow-2xl rounded-3xl p-0 overflow-hidden",children:[e.jsx(Pe,{className:"sr-only",children:"Editar Afiliado"}),e.jsxs("div",{className:"relative h-24 bg-gradient-to-br from-primary/20 via-secondary/20 to-accent/20",children:[e.jsx("div",{className:"absolute inset-0 bg-white/40 dark:bg-black/40 backdrop-blur-[2px]"}),e.jsxs("div",{className:"absolute bottom-6 left-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Editar Afiliado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Atualize os dados do perfil"})]})]}),W&&e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",children:"Nome Completo"}),e.jsx("div",{className:"relative group",children:e.jsx("input",{value:W.name,onChange:t=>Ne({...W,name:t.target.value}),className:"w-full bg-gray-50 dark:bg-white/5 border-2 border-transparent focus:border-primary/50 rounded-2xl px-4 py-3 outline-none transition-all duration-300 hover:bg-gray-100 dark:hover:bg-white/10 font-medium",placeholder:"Nome do afiliado"})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",children:"Instagram (sem @)"}),e.jsx("div",{className:"relative group",children:e.jsx("input",{value:W.instagram,onChange:t=>Ne({...W,instagram:t.target.value}),className:"w-full bg-gray-50 dark:bg-white/5 border-2 border-transparent focus:border-primary/50 rounded-2xl px-4 py-3 outline-none transition-all duration-300 hover:bg-gray-100 dark:hover:bg-white/10 font-medium",placeholder:"usuario"})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",children:"Link do Instagram"}),e.jsx("div",{className:"relative group",children:e.jsx("input",{value:W.instagramLink||"",onChange:t=>Ne({...W,instagramLink:t.target.value}),className:"w-full bg-gray-50 dark:bg-white/5 border-2 border-transparent focus:border-primary/50 rounded-2xl px-4 py-3 outline-none transition-all duration-300 hover:bg-gray-100 dark:hover:bg-white/10 font-medium",placeholder:"https://instagram.com/..."})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",children:"Observa√ß√µes"}),e.jsx("div",{className:"relative group",children:e.jsx("input",{value:W.notes||"",onChange:t=>Ne({...W,notes:t.target.value}),className:"w-full bg-gray-50 dark:bg-white/5 border-2 border-transparent focus:border-primary/50 rounded-2xl px-4 py-3 outline-none transition-all duration-300 hover:bg-gray-100 dark:hover:bg-white/10 font-medium",placeholder:"Anota√ß√µes gerais..."})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>Xe(!1),className:"flex-1 px-6 py-3 rounded-xl font-medium text-muted-foreground hover:bg-gray-100 dark:hover:bg-white/5 transition-colors duration-300",children:"Cancelar"}),e.jsx("button",{onClick:dr,className:"flex-[2] px-6 py-3 rounded-xl font-bold bg-gradient-to-r from-primary to-secondary text-white shadow-lg shadow-primary/25 hover:shadow-primary/40 hover:scale-[1.02] active:scale-[0.98] transition-all duration-300",children:"Salvar Altera√ß√µes"})]})]})]})}),e.jsx(Ie,{open:ee,onOpenChange:ie,children:e.jsx(Fe,{className:"w-[95vw] sm:w-full max-w-md max-h-[90vh] overflow-y-auto bg-background/95 backdrop-blur-2xl border-none shadow-2xl rounded-3xl p-0",children:e.jsxs("div",{className:"p-6",children:[e.jsx(Nr,{children:e.jsxs(Pe,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-yellow-500"}),"Como funcionam as Regras"]})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Esta aba exibe as regras atuais e ativas do seu sistema de gamifica√ß√£o."}),e.jsxs("div",{className:"bg-secondary/10 p-4 rounded-xl border border-secondary/20 space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-foreground text-sm flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-secondary"}),"Sincroniza√ß√£o Autom√°tica"]}),e.jsxs("p",{className:"text-sm text-muted-foreground leading-relaxed",children:['Essa aba "Regras" serve para explicar o funcionamento de cada ferramenta da gamifica√ß√£o.',e.jsx("br",{}),e.jsx("br",{}),"Ao criar ou editar um novo ",e.jsx("strong",{children:"n√≠vel"}),", ",e.jsx("strong",{children:"classe"})," (pontua√ß√£o) ou ",e.jsx("strong",{children:"conquista"})," na p√°gina de ",e.jsx("span",{className:"text-foreground font-medium",children:"Gamifica√ß√£o"}),', essas altera√ß√µes aparecer√£o automaticamente nos campos respectivos desta aba "Regras".']})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"bg-primary/10 text-primary rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold shrink-0 mt-0.5",children:"1"}),e.jsx("span",{children:'Configure os pontos e regras no painel "Gamifica√ß√£o".'})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"bg-primary/10 text-primary rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold shrink-0 mt-0.5",children:"2"}),e.jsx("span",{children:"Visualize aqui como o sistema de n√≠veis, classes e conquistas funcionam para os suas afiliadas."})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"bg-primary/10 text-primary rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold shrink-0 mt-0.5",children:"3"}),e.jsx("span",{children:"Ap√≥s ter configurado as regras do seu jeito, voc√™ pode mostrar essa aba de Regras para que suas afiliadas entendam como funciona a sua gamifica√ß√£o."})]})]})]}),e.jsx(kr,{className:"mt-6",children:e.jsx(Ge,{onClick:()=>ie(!1),className:"w-full sm:w-auto",children:"Entendi"})})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-6",children:e.jsxs(yr,{value:s,onValueChange:c,className:"w-full",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 mb-8",children:[e.jsx("div",{id:"dashboard-tabs",children:e.jsxs(jr,{className:"relative h-auto bg-gray-100/50 dark:bg-white/5 backdrop-blur-xl border border-black/5 dark:border-white/10 p-1.5 rounded-2xl inline-flex w-full sm:w-auto shadow-sm",children:[e.jsxs(it,{value:"dashboard",className:"relative z-10 flex-1 sm:flex-none flex items-center justify-center gap-2 rounded-xl px-2 sm:px-6 py-3 text-xs sm:text-sm font-medium text-muted-foreground transition-all duration-300 data-[state=active]:bg-white dark:data-[state=active]:bg-white/10 data-[state=active]:text-primary dark:data-[state=active]:text-primary data-[state=active]:shadow-md dark:data-[state=active]:shadow-sm dark:data-[state=active]:shadow-black/50 hover:text-foreground dark:hover:text-white min-w-0 sm:min-w-[120px]",children:[e.jsx(Ft,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"truncate",children:"Dashboard"})]}),e.jsxs(it,{value:"gamificacao","aria-label":"Regras",className:"relative z-10 flex-1 sm:flex-none flex items-center justify-center gap-2 rounded-xl px-2 sm:px-6 py-3 text-xs sm:text-sm font-medium text-muted-foreground transition-all duration-300 data-[state=active]:bg-white dark:data-[state=active]:bg-white/10 data-[state=active]:text-primary dark:data-[state=active]:text-primary data-[state=active]:shadow-md dark:data-[state=active]:shadow-sm dark:data-[state=active]:shadow-black/50 hover:text-foreground dark:hover:text-white min-w-0 sm:min-w-[120px]",children:[e.jsx(ot,{className:"w-4 h-4 shrink-0","aria-hidden":"true",focusable:"false"}),e.jsx("span",{className:"truncate",children:"Regras"})]}),e.jsxs(it,{value:"metricas",className:"relative z-10 flex-1 sm:flex-none flex items-center justify-center gap-2 rounded-xl px-2 sm:px-6 py-3 text-xs sm:text-sm font-medium text-muted-foreground transition-all duration-300 data-[state=active]:bg-white dark:data-[state=active]:bg-white/10 data-[state=active]:text-primary dark:data-[state=active]:text-primary data-[state=active]:shadow-md dark:data-[state=active]:shadow-sm dark:data-[state=active]:shadow-black/50 hover:text-foreground dark:hover:text-white min-w-0 sm:min-w-[120px]",children:[e.jsx(Cr,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"truncate",children:"Ranking"})]})]})}),s==="dashboard"&&e.jsxs(Ge,{onClick:Jt,variant:"outline",className:"flex gap-2 bg-white/10 hover:bg-white/20 border-white/20 text-foreground px-6",children:[e.jsx(Je,{className:"w-4 h-4 text-yellow-500"}),"Como usar"]})]}),e.jsxs(lt,{value:"dashboard",className:"space-y-6 sm:space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 relative",id:"dashboard-stats",children:[e.jsx(xe,{hover:!0,className:"group",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/10 border border-primary/20 group-hover:border-primary/40 transition-all duration-300",children:e.jsx(St,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl sm:text-4xl font-bold text-foreground",children:Qt.length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Total de Afiliadas Ativas"})]})]})}),e.jsx(xe,{hover:!0,className:"group",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-accent/10 border border-accent/20 group-hover:border-accent/40 transition-all duration-300",children:e.jsx(Pt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-accent"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl sm:text-4xl font-bold text-foreground",children:[K.length>0?Math.round(K.reduce((t,n)=>t+(n.performance||0),0)/K.length):0,"%"]}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Taxa M√©dia de Cumprimento"})]})]})}),e.jsx(xe,{hover:!0,className:"group",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-secondary/10 border border-secondary/20 group-hover:border-secondary/40 transition-all duration-300",children:e.jsx(Ot,{className:"w-5 h-5 sm:w-6 sm:h-6 text-secondary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl sm:text-4xl font-bold text-foreground",children:K.filter(t=>(t.posted||0)===0).length}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Afiliadas sem postagem no m√™s"}),e.jsx("div",{className:"text-xs text-muted-foreground/70",children:"Com base no m√™s selecionado"})]})]})}),e.jsx(xe,{hover:!0,className:"group",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/10 border border-primary/20 group-hover:border-primary/40 transition-all duration-300",children:e.jsx(_r,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-foreground",children:K.length>0?[...K].sort((t,n)=>(n.points||0)-(t.points||0))[0].name:"N/A"}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Afiliada Destaque"}),e.jsx("div",{className:"text-xs text-muted-foreground/70",children:K.length>0?`${[...K].sort((t,n)=>(n.points||0)-(t.points||0))[0].points} pts`:"Sem dados"})]})]})})]}),e.jsxs(xe,{className:"animate-scale-in",id:"dashboard-add-affiliate",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-primary/10 border border-primary/20",children:e.jsx(dt,{className:"w-5 h-5 text-primary"})}),e.jsx("span",{className:"text-foreground",children:"Adicionar Nova Afiliada"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-foreground",children:"Nome Completo"}),e.jsx(Ee,{value:de.nome,onChange:t=>$e({...de,nome:t.target.value}),placeholder:"",className:"glass-card border-border/50 focus:border-primary transition-all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-foreground",children:"Instagram (sem @)"}),e.jsx(Ee,{value:de.instagram,onChange:t=>$e({...de,instagram:t.target.value}),placeholder:"",className:"glass-card border-border/50 focus:border-primary transition-all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-foreground",children:"Link do Instagram"}),e.jsx(Ee,{value:de.link,onChange:t=>$e({...de,link:t.target.value}),placeholder:"https://instagram.com/usuario",className:"glass-card border-border/50 focus:border-primary transition-all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-foreground",children:"Observa√ß√µes"}),e.jsx(Ee,{value:de.observacoes,onChange:t=>$e({...de,observacoes:t.target.value}),placeholder:"",className:"glass-card border-border/50 focus:border-primary transition-all"})]})]}),e.jsxs(Ge,{onClick:nr,disabled:ue,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground py-4 sm:py-6 text-sm sm:text-lg font-semibold transition-all duration-300 disabled:opacity-60",children:[e.jsx(dt,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-2"}),ue?"Adicionando...":"Adicionar Afiliada"]})]}),e.jsxs(xe,{id:"dashboard-list",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-primary/10 border border-primary/20",children:e.jsx(St,{className:"w-5 h-5 text-primary"})}),e.jsx("span",{className:"text-foreground",children:"Gerenciar Afiliadas"})]}),e.jsxs("div",{className:"flex flex-col xl:flex-row items-stretch xl:items-center gap-3 w-full xl:w-auto mt-4 sm:mt-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("div",{className:"relative glass-card flex items-center justify-between sm:justify-center gap-2 px-3 sm:px-4 py-2 rounded-xl border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium whitespace-nowrap min-w-[100px] text-center",children:[vt," de ",_]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>Ct("prev"),className:"p-1 hover:bg-primary/10 rounded-lg text-primary hover:scale-110 transition-all",children:e.jsx(Et,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ct("next"),className:"p-1 hover:bg-primary/10 rounded-lg text-primary hover:scale-110 transition-all",children:e.jsx(At,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between sm:justify-start",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d("grid"),className:`p-2 rounded-lg transition-all duration-300 ${u==="grid"?"bg-primary text-primary-foreground":"glass-card border border-border/50"}`,children:e.jsx(Mr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d("list"),className:`p-2 rounded-lg transition-all duration-300 ${u==="list"?"bg-primary text-primary-foreground":"glass-card border border-border/50"}`,children:e.jsx(Sr,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:()=>Ue(!0),className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-3 py-2 h-9 rounded-lg text-xs sm:text-sm font-medium bg-destructive/10 text-destructive hover:bg-destructive/20 transition-colors border border-destructive/30 whitespace-nowrap",title:"Apagar dados do m√™s",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Apagar m√™s"})]})]})]}),e.jsxs("div",{className:"relative w-full xl:w-64",children:[e.jsx(It,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),e.jsx(Ee,{value:at,onChange:t=>er(t.target.value),placeholder:"Buscar afiliada...",className:"pl-9 w-full glass-card border-border/50 focus:border-primary transition-all text-xs sm:text-sm"})]})]})]}),u==="grid"?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:pt.map(t=>e.jsxs("div",{className:"group relative overflow-hidden rounded-2xl bg-black/5 dark:bg-white/5 border border-transparent p-1 transition-all duration-300 hover:shadow-lg hover:shadow-primary/5 dark:hover:shadow-black/40",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),e.jsxs("div",{className:"relative h-full rounded-xl bg-gray-50/50 dark:bg-black/40 p-4 transition-colors duration-300 group-hover:bg-white dark:group-hover:bg-black/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs("div",{className:"relative w-12 h-12 shrink-0",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 rounded-full animate-pulse group-hover:animate-none"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-primary font-bold text-lg bg-white dark:bg-white/10 rounded-full border-2 border-primary/20 group-hover:border-primary transition-colors duration-300",children:t.name.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-base text-foreground truncate group-hover:text-primary transition-colors",children:t.name}),e.jsx("div",{className:"text-xs text-muted-foreground truncate mb-0.5",children:t.username}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium",children:[e.jsxs("span",{className:"text-primary bg-primary/10 px-2 py-0.5 rounded-full",children:[t.points," pts"]}),e.jsx("span",{className:"text-muted-foreground",children:"‚Ä¢"}),e.jsx("span",{className:"text-muted-foreground",children:t.level})]})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-medium",children:[e.jsx("span",{className:"text-muted-foreground",children:"Performance"}),e.jsx("span",{className:t.performance&&t.performance>=80?"text-green-500":"text-primary",children:t.performance?`${t.performance}%`:"0%"})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-white/5 rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${t.performance&&t.performance>=80?"bg-gradient-to-r from-green-500 to-emerald-400":"bg-gradient-to-r from-primary to-blue-400"}`,style:{width:`${t.performance||0}%`}})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Conquistas"}),e.jsx("span",{className:"text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 rounded-md",children:t.myAchievements?.length||0})]}),e.jsxs("div",{className:"flex items-center gap-1.5 overflow-x-auto pb-2 -mx-1 px-1 scrollbar-thin scrollbar-thumb-primary/10 scrollbar-track-transparent",children:[(!t.myAchievements||t.myAchievements.length===0)&&e.jsx("div",{className:"text-[10px] text-muted-foreground/50 italic w-full text-center py-1",children:"Nenhuma conquista"}),t.myAchievements?.map(n=>e.jsxs(br,{delayDuration:0,children:[e.jsx(wr,{asChild:!0,children:e.jsx("div",{className:"w-7 h-7 shrink-0 rounded-lg bg-gradient-to-br from-yellow-500/10 to-orange-500/10 border border-yellow-500/20 flex items-center justify-center text-sm hover:scale-110 hover:shadow-sm hover:border-yellow-500/50 transition-all cursor-help group/ach",children:n.icon?.startsWith("http")?e.jsx("img",{src:n.icon,alt:"",className:"w-full h-full object-cover rounded-lg"}):e.jsx("span",{className:"leading-none group-hover/ach:animate-bounce",children:n.icon||"üèÜ"})})}),e.jsx(vr,{side:"top",className:"max-w-[200px]",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"shrink-0 text-lg",children:n.icon||"üèÜ"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-foreground",children:n.title}),e.jsx("div",{className:"text-[10px] text-muted-foreground leading-tight mt-0.5",children:n.description}),e.jsxs("div",{className:"text-[10px] text-yellow-500 font-bold mt-1",children:["+",n.xp," XP"]})]})]})})]},n.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 py-3 border-t border-gray-200 dark:border-white/5 mb-4",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-gray-100/50 dark:bg-white/5 group-hover:bg-white dark:group-hover:bg-white/10 transition-colors",children:[e.jsx("div",{className:"text-accent font-bold text-sm",children:t.posted}),e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted-foreground mt-0.5",children:"Dia Positivo"})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-gray-100/50 dark:bg-white/5 group-hover:bg-white dark:group-hover:bg-white/10 transition-colors",children:[e.jsx("div",{className:"text-destructive font-bold text-sm",children:t.notPosted}),e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted-foreground mt-0.5",children:"Dia Negativo"})]})]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{onClick:()=>kt(t),className:"flex-1 h-9 rounded-lg bg-gray-100 dark:bg-white/5 text-muted-foreground hover:text-primary hover:bg-primary/10 dark:hover:bg-primary/20 transition-all duration-300 flex items-center justify-center group/btn",title:"Editar","aria-label":"Editar afiliado",children:e.jsx(Qe,{className:"w-4 h-4 group-hover/btn:scale-110 transition-transform"})}),e.jsx("button",{onClick:()=>{t.instagramLink?window.open(t.instagramLink,"_blank"):A.error("Link do Instagram n√£o cadastrado")},className:`flex-1 h-9 rounded-lg bg-gray-100 dark:bg-white/5 text-muted-foreground transition-all duration-300 flex items-center justify-center group/btn ${t.instagramLink?"hover:text-[#E1306C] hover:bg-[#E1306C]/10":"opacity-50 cursor-not-allowed hover:bg-transparent hover:text-muted-foreground"}`,title:t.instagramLink?"Visitar Instagram":"Link n√£o cadastrado","aria-label":"Visitar Instagram do afiliado",children:e.jsx(Mt,{className:"w-4 h-4 group-hover/btn:scale-110 transition-transform"})}),e.jsx("button",{onClick:()=>Nt(t),className:"flex-1 h-9 rounded-lg bg-gray-100 dark:bg-white/5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 dark:hover:bg-destructive/20 transition-all duration-300 flex items-center justify-center group/btn",title:"Excluir","aria-label":"Excluir afiliado",children:e.jsx(Oe,{className:"w-4 h-4 group-hover/btn:scale-110 transition-transform"})})]}),e.jsxs("button",{onClick:()=>Ye(t),className:"w-full h-9 rounded-lg border border-primary/20 bg-primary/5 text-primary hover:bg-primary/10 transition-all duration-300 flex items-center justify-center gap-2 group/btn font-medium text-sm",title:"Calend√°rio","aria-label":"Ver calend√°rio",children:[e.jsx(Ae,{className:"w-4 h-4 group-hover/btn:scale-110 transition-transform"}),e.jsx("span",{children:"Calend√°rio"})]}),t.noRegistro&&e.jsx("button",{onClick:()=>Ye(t),className:"w-full mt-3 bg-gradient-to-r from-primary to-secondary text-white rounded-lg py-2.5 text-xs font-bold uppercase tracking-wide shadow-lg shadow-primary/20 hover:shadow-primary/40 hover:scale-[1.02] active:scale-[0.98] transition-all duration-300",children:"Come√ßar a marcar"})]})]},t.id))}):e.jsx("div",{className:"space-y-3",children:pt.map(t=>e.jsxs("div",{className:"glass-card-hover border border-border/50 rounded-2xl p-4 group",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsxs("div",{className:"relative w-12 h-12 shrink-0",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/20 rounded-full"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-primary font-bold text-lg bg-white dark:bg-white/10 rounded-full border-2 border-primary/20 group-hover:border-primary transition-colors duration-300",children:t.name.charAt(0)})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-bold text-base text-foreground truncate group-hover:text-primary transition-colors",children:t.name}),e.jsx("div",{className:"text-xs text-muted-foreground truncate mb-1",children:t.username}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium flex-wrap",children:[e.jsxs("span",{className:"text-primary bg-primary/10 px-2 py-0.5 rounded-full",children:[t.points," pts"]}),e.jsx("span",{className:"text-muted-foreground",children:"‚Ä¢"}),e.jsx("span",{className:"text-muted-foreground",children:t.level}),e.jsx("span",{className:"text-muted-foreground",children:"‚Ä¢"}),e.jsx("span",{className:t.performance&&t.performance>=80?"text-green-500":"text-primary",children:t.performance?`${t.performance}%`:"0%"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-accent font-bold text-sm",children:t.posted}),e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted-foreground mt-0.5",children:"Dia Positivo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-destructive font-bold text-sm",children:t.notPosted}),e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted-foreground mt-0.5",children:"Dia Negativo"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>kt(t),className:"w-10 h-9 rounded-lg bg-gray-100 dark:bg-white/5 text-muted-foreground hover:text-primary hover:bg-primary/10 dark:hover:bg-primary/20 transition-all duration-300 flex items-center justify-center group/btn",title:"Editar","aria-label":"Editar afiliado",children:e.jsx(Qe,{className:"w-4 h-4 group-hover/btn:scale-110 transition-transform"})}),e.jsx("button",{onClick:()=>{t.instagramLink?window.open(t.instagramLink,"_blank"):A.error("Link do Instagram n√£o cadastrado")},className:`w-10 h-9 rounded-lg bg-gray-100 dark:bg-white/5 text-muted-foreground transition-all duration-300 flex items-center justify-center group/btn ${t.instagramLink?"hover:text-[#E1306C] hover:bg-[#E1306C]/10":"opacity-50 cursor-not-allowed hover:bg-transparent hover:text-muted-foreground"}`,title:t.instagramLink?"Visitar Instagram":"Link n√£o cadastrado","aria-label":"Visitar Instagram do afiliado",children:e.jsx(Mt,{className:"w-4 h-4 group-hover/btn:scale-110 transition-transform"})}),e.jsx("button",{onClick:()=>Ye(t),className:"w-10 h-9 rounded-lg bg-gray-100 dark:bg-white/5 text-muted-foreground hover:text-secondary hover:bg-secondary/10 dark:hover:bg-secondary/20 transition-all duration-300 flex items-center justify-center group/btn tutorial-calendar-btn",title:"Calend√°rio","aria-label":"Ver calend√°rio",children:e.jsx(Ae,{className:"w-4 h-4 group-hover/btn:scale-110 transition-transform"})}),e.jsx("button",{onClick:()=>Nt(t),className:"w-10 h-9 rounded-lg bg-gray-100 dark:bg-white/5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 dark:hover:bg-destructive/20 transition-all duration-300 flex items-center justify-center group/btn",title:"Excluir","aria-label":"Excluir afiliado",children:e.jsx(Oe,{className:"w-4 h-4 group-hover/btn:scale-110 transition-transform"})})]})]})]}),t.noRegistro&&e.jsx("button",{onClick:()=>Ye(t),className:"w-full mt-3 bg-gradient-to-r from-primary to-secondary text-white rounded-lg py-2.5 text-xs font-bold uppercase tracking-wide shadow-lg shadow-primary/20 hover:shadow-primary/40 hover:scale-[1.02] active:scale-[0.98] transition-all duration-300",children:"Come√ßar a marcar"})]},t.id))})]})]}),e.jsx(lt,{value:"gamificacao",className:"space-y-6 sm:space-y-8 animate-fade-in",children:e.jsxs(xe,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-xl bg-secondary/10 border border-secondary/20",children:e.jsx(Lt,{className:"w-5 h-5 text-secondary"})}),e.jsx("span",{className:"text-foreground",children:"Sistema de Gamifica√ß√£o"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Acompanhe pontua√ß√£o, n√≠veis e conquistas das suas afiliadas"})]}),e.jsxs(Ge,{onClick:()=>ie(!0),variant:"outline",className:"flex gap-2 bg-white/10 hover:bg-white/20 border-white/20 text-foreground px-4 self-start sm:self-center",children:[e.jsx(Je,{className:"w-4 h-4 text-yellow-500"}),"Como funciona"]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-bold flex items-center gap-2 mb-1",children:[e.jsx(ot,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-foreground",children:"Como Funciona a Pontua√ß√£o"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Cada a√ß√£o registrada no calend√°rio gera pontos (XP). Exemplo: Ao marcar "Postou Completo", voc√™ ganha 5 XP imediatamente. Esses pontos ajudam voc√™ a subir de n√≠vel e desbloquear novas recompensas.'})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:Q.map(t=>{let n=ot;t.key==="postou_vendas"&&(n=dt),t.key==="postou"&&(n=Pt),t.key==="nao_postou"&&(n=Ot),t.key==="sem_analise"&&(n=Ae);const m=t.bg||"#9b184e",k=t.textColor||"#111827";return e.jsxs("div",{className:"group relative overflow-hidden rounded-2xl border transition-all duration-300 hover:scale-[1.02] hover:shadow-xl h-full flex flex-col",style:{borderColor:`${m}60`,boxShadow:`0 8px 30px -10px ${m}40`},children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.05] dark:opacity-[0.1] transition-opacity duration-300 group-hover:opacity-20",style:{background:m}}),e.jsxs("div",{className:"relative flex-1 flex flex-col justify-between bg-white/50 dark:bg-black/20 p-5 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 w-full",children:[e.jsx("div",{className:"rounded-xl p-2.5 bg-white/50 dark:bg-black/20 border shadow-none transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3 shrink-0 dark:!text-white",style:{color:k,borderColor:`${m}30`},children:e.jsx(n,{className:"w-6 h-6"})}),e.jsxs("div",{className:"px-3 py-1 rounded-full text-xs font-bold border backdrop-blur-sm whitespace-nowrap ml-2 shrink-0 dark:!text-white dark:!border-white/20 dark:!bg-white/10",style:{background:`${m}20`,borderColor:`${m}40`,color:k},children:["+",t.points," pts"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-start text-left",children:[e.jsx("h4",{className:"text-lg font-bold text-foreground mb-2 dark:group-hover:text-white transition-colors break-words",children:t.label}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed dark:group-hover:text-muted-foreground/80 break-words",children:t.description||""})]})]})]},t.key)})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-bold flex items-center gap-2 mb-1",children:[e.jsx(Dt,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-foreground",children:"Como Funciona a Conquista"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Conquistas s√£o marcos especiais de dedica√ß√£o. Exemplo: Manter uma sequ√™ncia de 5 dias postando sem falhar libera um b√¥nus extra de 50 XP. Elas podem ser mensais, semanais ou √∫nicas."})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:re.map(t=>e.jsxs("div",{className:"group relative overflow-hidden rounded-2xl bg-black/5 dark:bg-white/5 border border-transparent p-1 transition-all duration-300 hover:shadow-lg hover:shadow-primary/5 dark:hover:shadow-black/40 h-full",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-yellow-500/10 to-orange-500/5 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),e.jsxs("div",{className:"relative flex h-full flex-col justify-between rounded-xl bg-white dark:bg-black/40 p-5 backdrop-blur-md transition-colors duration-300 group-hover:bg-white/80 dark:group-hover:bg-black/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 w-full",children:[e.jsx("div",{className:"rounded-xl p-2.5 bg-black/5 dark:bg-white/5 border border-black/5 dark:border-white/10 text-yellow-500 shadow-none transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3 shrink-0",children:t.icon?.startsWith("http")?e.jsx("img",{src:t.icon,alt:"",className:"w-6 h-6 object-cover rounded-md"}):e.jsx("span",{className:"text-xl leading-none",children:t.icon||"üèÜ"})}),e.jsxs("div",{className:"px-3 py-1 rounded-full text-xs font-bold border backdrop-blur-sm bg-yellow-500/10 border-yellow-500/20 text-yellow-600 dark:text-yellow-500 whitespace-nowrap ml-2 shrink-0",children:["+",t.xp," XP"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-start text-left",children:[e.jsx("h4",{className:"text-lg font-bold text-foreground mb-2 dark:group-hover:text-white transition-colors break-words",children:t.title}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed dark:group-hover:text-muted-foreground/80 break-words",children:t.description})]})]})]},t.id))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-bold flex items-center gap-2 mb-1",children:[e.jsx(Er,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-foreground",children:"Como Funcionam os N√≠veis"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Seu n√≠vel reflete sua experi√™ncia total acumulada. Quanto mais XP voc√™ ganha, mais alto voc√™ sobe na hierarquia."})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:te.map((t,n)=>{const m=te[n+1],k=m?`${t.minXP} - ${m.minXP} XP`:`${t.minXP}+ XP`;return e.jsxs("div",{className:"group relative overflow-hidden rounded-2xl bg-black/5 dark:bg-white/5 border border-transparent p-1 transition-all duration-300 hover:shadow-lg hover:shadow-primary/5 dark:hover:shadow-black/40 h-full",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${t.color} opacity-0 transition-opacity duration-300 group-hover:opacity-10`}),e.jsxs("div",{className:"relative flex h-full flex-col justify-between rounded-xl bg-white dark:bg-black/40 p-5 backdrop-blur-md transition-colors duration-300 group-hover:bg-white/80 dark:group-hover:bg-black/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 w-full",children:[e.jsx("div",{className:"rounded-xl p-2.5 bg-black/5 dark:bg-white/5 border border-black/5 dark:border-white/10 shadow-none transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3 shrink-0",children:e.jsx("div",{className:`w-6 h-6 rounded-full bg-gradient-to-br ${t.color} flex items-center justify-center text-[10px] font-bold text-white overflow-hidden`,children:t.icon?.startsWith("http")?e.jsx("img",{src:t.icon,alt:"",className:"w-full h-full object-cover"}):t.icon?e.jsx("span",{className:"text-sm leading-none",children:t.icon}):t.name.charAt(0)})}),e.jsxs("div",{className:"px-3 py-1 rounded-full text-xs font-bold border backdrop-blur-sm bg-primary/10 border-primary/20 text-primary whitespace-nowrap ml-2 shrink-0",children:["N√≠vel ",n+1]})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-start text-left",children:[e.jsx("h4",{className:"text-lg font-bold text-foreground mb-2 dark:group-hover:text-white transition-colors break-words",children:t.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed dark:group-hover:text-muted-foreground/80 break-words",children:["Faixa de XP: ",e.jsx("span",{className:"font-mono font-bold text-foreground",children:k})]})]})]})]},t.id)})})]}),e.jsx("div",{className:"glass-card border-l-4 border-primary rounded-xl p-4 mb-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 border border-primary/20 flex-shrink-0",children:e.jsx(Je,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-foreground mb-1 text-sm sm:text-base",children:"Dica:"}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground",children:"Complete conquistas para ganhar pontos extras! Cada conquista tem sua pr√≥pria recompensa em pontos."})]})]})})]})}),e.jsx(lt,{value:"metricas",className:"space-y-6 sm:space-y-8 animate-fade-in",children:e.jsx(xe,{children:e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-bold flex items-center gap-2",children:[e.jsx(Lt,{className:"w-5 h-5 text-secondary"}),e.jsx("span",{className:"text-foreground",children:"Ranking de Pontua√ß√£o"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto",children:[e.jsx(It,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),e.jsx(Ee,{value:C,onChange:t=>T(t.target.value),placeholder:"Buscar afiliada...",className:"pl-10 w-full sm:w-64 glass-card border-border/50 focus:border-primary transition-all"})]}),e.jsxs("div",{className:"relative glass-card flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl border border-border/50",children:[e.jsx(Ae,{className:"w-4 h-4 text-primary"}),e.jsx("button",{onClick:()=>wt("prev"),className:"text-primary hover:scale-110 transition-transform",children:e.jsx(Et,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:[ar," de ",B]}),e.jsx("button",{onClick:()=>wt("next"),className:"text-primary hover:scale-110 transition-transform",children:e.jsx(At,{className:"w-4 h-4"})})]})]})]}),e.jsx("div",{className:"space-y-3",children:[...oe].sort((t,n)=>n.points-t.points).map((t,n)=>({...t,rank:n+1})).filter(t=>t.name.toLowerCase().includes(C.toLowerCase())).map(t=>{const{currentLevel:n,nextLevel:m,progress:k}=ge(t.points),v=t.rank===1;return e.jsxs("div",{className:`glass-card-hover rounded-2xl border border-border/50 group relative overflow-hidden transition-all duration-500 ${v?"bg-gradient-to-r from-yellow-500/10 to-transparent border-yellow-500/30 pt-9 pb-5 px-4":"p-4"}`,children:[v&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-400/5 via-transparent to-transparent animate-shimmer",style:{backgroundSize:"200% 100%"}}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 flex-wrap sm:flex-nowrap relative z-10",children:[e.jsxs("div",{className:`w-12 h-12 sm:w-14 sm:h-14 rounded-full flex items-center justify-center font-bold text-lg flex-shrink-0 transition-all duration-300 relative ${v?"bg-yellow-500/20 text-yellow-500 border-2 border-yellow-500":"bg-primary/20 text-primary border-2 border-primary/40 group-hover:border-primary"}`,children:[v&&e.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 z-20",children:e.jsxs("div",{className:"relative",children:[e.jsx(Dt,{className:"w-8 h-8 text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.6)] animate-bounce",style:{animationDuration:"2s",filter:"drop-shadow(0 0 5px rgba(234, 179, 8, 0.5))"}}),e.jsx("div",{className:"absolute inset-0 bg-yellow-400/30 blur-xl rounded-full animate-pulse"})]})}),t.rank]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`font-semibold text-sm sm:text-base ${v?"text-yellow-500":"text-foreground"}`,children:t.name}),v&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-yellow-500/20 text-yellow-600 font-bold uppercase tracking-wider border border-yellow-500/30",children:"L√≠der"})]}),e.jsx("div",{className:"text-xs text-muted-foreground mb-1.5",children:n.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground whitespace-nowrap",children:["XP: ",t.points,"/",m.minXP]}),e.jsx("div",{className:"flex-1 bg-muted/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-1000 ease-out ${v?"bg-gradient-to-r from-yellow-400 to-yellow-600 shadow-[0_0_10px_rgba(234,179,8,0.5)]":"bg-primary"}`,style:{width:`${k}%`}})})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center px-2 sm:px-4 border-l border-border/30 min-w-[90px]",children:[e.jsx("div",{className:"font-bold text-accent text-base sm:text-lg",children:t.posted||0}),e.jsxs("div",{className:"flex gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-xs text-accent",title:"Postou",children:["‚úÖ",t.posted||0]}),e.jsxs("span",{className:"text-xs text-destructive",title:"N√£o Postou",children:["‚ùå",t.notPosted||0]})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider mt-0.5 hidden sm:block",children:"Postagens"})]}),e.jsx("div",{className:"flex items-center gap-3 sm:gap-4",children:e.jsxs("div",{className:"text-right min-w-[80px]",children:[e.jsxs("div",{className:`font-bold text-lg sm:text-xl ${v?"text-yellow-500 drop-shadow-sm":"text-foreground"}`,children:[t.points," pts"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total acumulado"})]})})]})]},t.id)})})]})})})]})}),e.jsx("footer",{className:"glass-card text-center py-6 sm:py-8 text-xs sm:text-sm text-muted-foreground mt-8 sm:mt-12 border-t border-border/50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4",children:[e.jsx($t,{to:"/support",className:"hover:text-primary transition-colors smooth-transition",children:"Condi√ß√µes e suporte"}),e.jsx("span",{className:"hidden sm:inline",children:"|"}),e.jsx($t,{to:"/privacy",className:"hover:text-primary transition-colors smooth-transition",children:"Pol√≠tica de Privacidade"})]})})})]}),y&&w&&e.jsx(Wr,{isOpen:y,onClose:()=>{g(!1),S(null)},affiliate:K.find(t=>t.id===w.id)||w,calendarStatuses:Kt,classes:Q,onSetStatus:sr})]})}function ga(){return e.jsx(fr,{children:e.jsx(Vr,{})})}export{ga as default};
