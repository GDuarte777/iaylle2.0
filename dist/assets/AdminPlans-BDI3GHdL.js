import{u as $e,j as l,o as e,q as Le,x as Oe,N as h,ac as Me,X as je,H as i,I as v}from"./index-D9dO6jDR.js";import{G as _}from"./GlassCard-3LL1uNH4.js";import{D as V,a as Y,b as H,c as ze,e as Be,d as Ge}from"./dialog-CTG_fKa3.js";import{T as qe,a as Ue,b as K,c as W}from"./tabs-BzIc16-c.js";import{S as Ve}from"./scroll-area-BWKCE_5S.js";import{c as Ye}from"./index-CurXoWR1.js";import{S as be}from"./switch-CpBR6YKs.js";import{L as he}from"./label-oZkRqp9j.js";import{P as X}from"./plus-B0uAgXLJ.js";import{C as J}from"./check-DPcULkwW.js";import{T as ye}from"./trash-2-C6TvX7gl.js";import{S as ve}from"./star-BDuaNbY7.js";import{R as He,a as Ke,G as We}from"./Item-Dv_b0aN-.js";import"./index-CREuF23G.js";import"./index-CQKvY29V.js";import"./index-DwWHu9OX.js";import"./index-CfA0gxda.js";import"./index-BdQq_4o_.js";import"./index-B6rWjmp5.js";class Xe{constructor(){this.componentControls=new Set}subscribe(o){return this.componentControls.add(o),()=>this.componentControls.delete(o)}start(o,g){this.componentControls.forEach(x=>{x.start(o.nativeEvent||o,g)})}cancel(){this.componentControls.forEach(o=>{o.cancel()})}stop(){this.componentControls.forEach(o=>{o.stop()})}}const Je=()=>new Xe;function Qe(){return $e(Je)}var Ze=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],er=Ze.reduce((c,o)=>{const g=Ye(`Primitive.${o}`),x=l.forwardRef((f,b)=>{const{asChild:y,...a}=f,d=y?g:o;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(d,{...a,ref:b})});return x.displayName=`Primitive.${o}`,{...c,[o]:x}},{}),rr="Separator",Ne="horizontal",sr=["horizontal","vertical"],we=l.forwardRef((c,o)=>{const{decorative:g,orientation:x=Ne,...f}=c,b=ar(x)?x:Ne,a=g?{role:"none"}:{"aria-orientation":b==="vertical"?b:void 0,role:"separator"};return e.jsx(er.div,{"data-orientation":b,...a,...f,ref:o})});we.displayName=rr;function ar(c){return sr.includes(c)}var Ce=we;const Q=l.forwardRef(({className:c,orientation:o="horizontal",decorative:g=!0,...x},f)=>e.jsx(Ce,{ref:f,decorative:g,orientation:o,className:Le("shrink-0 bg-border",o==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",c),...x}));Q.displayName=Ce.displayName;const tr=({feature:c,index:o,handleUpdateFeature:g,handleRemoveFeature:x})=>{const f=Qe();return e.jsxs(Ke,{value:c,dragListener:!1,dragControls:f,className:"group flex items-center gap-3 p-2 rounded-xl bg-card border border-border hover:border-primary/20 transition-all relative",children:[e.jsx("div",{className:"cursor-grab active:cursor-grabbing p-2 text-muted-foreground/50 hover:text-foreground transition-colors -ml-1 touch-none",onPointerDown:b=>f.start(b),children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>g(o,"included",!c.included),className:`p-2 rounded-lg transition-colors ${c.included?"bg-green-500/10 text-green-600 dark:text-green-400 hover:bg-green-500/20":"bg-red-500/10 text-red-600 dark:text-red-400 hover:bg-red-500/20"}`,title:c.included?"Incluído":"Não incluído",children:c.included?e.jsx(J,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"})}),e.jsx("input",{value:c.text,onChange:b=>g(o,"text",b.target.value),placeholder:"Descreva a funcionalidade...",className:"flex-1 bg-transparent border-none text-sm focus:ring-0 px-0 placeholder:text-muted-foreground/50"}),e.jsx("button",{type:"button",onClick:()=>x(o),className:"p-2 rounded-lg text-muted-foreground hover:text-red-500 hover:bg-red-500/10 transition-colors opacity-0 group-hover:opacity-100 focus:opacity-100",title:"Remover",children:e.jsx(ye,{className:"w-4 h-4"})})]})};function Cr(){const{plans:c,fetchPlans:o,addPlan:g,updatePlan:x,deletePlan:f}=Oe(),[b,y]=l.useState(!1),[a,d]=l.useState({}),[R,S]=l.useState(""),[F,E]=l.useState(""),[C,$]=l.useState(null),[Z,ee]=l.useState(!1),[re,se]=l.useState(!1),[L,Pe]=l.useState(null),[O,k]=l.useState(null),[M,ae]=l.useState(!0),[z,te]=l.useState(14),[D,oe]=l.useState(!1),[ne,le]=l.useState(!1),[ke,B]=l.useState("general"),I=r=>r.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}),Se=r=>{const s=r.trim().replace(/[^\d.,]/g,"");if(!s)return null;if(s.includes(",")){const m=s.replace(/\./g,"").split(",");if(m.length>2)return null;const N=m[0].replace(/\D/g,""),j=(m[1]??"").replace(/\D/g,"");if(!N&&!j)return null;const T=N?parseInt(N,10):0,U=j?parseInt((j+"00").slice(0,2),10):0;return T*100+U}if(s.match(/^\d+\.(\d{1,2})$/)){const[p,m]=s.split("."),N=parseInt(p,10),j=parseInt((m+"00").slice(0,2),10);return N*100+j}const n=s.replace(/\D/g,"");return n?parseInt(n,10)*100:null},P=r=>{const s=Se(r);return s===null?null:s/100},G=[{id:"/dashboard",label:"Dashboard (Visão Geral)"},{id:"/dashboard/gamification",label:"Gamificação"},{id:"/dashboard/settings",label:"Configurações"},{id:"/dashboard/sorteios",label:"Sorteios"},{id:"/dashboard/link-bio",label:"Link na Bio"},{id:"/dashboard/whatsapp-link",label:"Gerador WhatsApp"},{id:"/dashboard/roleta",label:"Roleta Criativa"},{id:"/dashboard/workflows",label:"Mapa Mental"},{id:"/dashboard/workflow",label:"Mapa Mental (Editor)"},{id:"/dashboard/ranking",label:"Ranking Global"}],[ie,de]=l.useState(!1),[ce,ue]=l.useState([]),[Ee,q]=l.useState(!1),[me,pe]=l.useState(!1),[u,w]=l.useState({code:"",name:"",percentOff:10,maxRedemptions:"",duration:"once",durationInMonths:""});l.useEffect(()=>{o()},[o]),l.useEffect(()=>{(async()=>{const{data:s}=await v.functions.invoke("admin-stripe-plan",{body:{action:"status"}});Pe(!!s?.stripeConfigured)})()},[]);const A=async()=>{try{de(!0);const{data:r,error:s}=await v.functions.invoke("admin-stripe-coupon",{body:{action:"list"}});if(s)throw s;ue(r?.items??[])}catch{ue([]),i.error("Erro ao carregar cupons")}finally{de(!1)}};l.useEffect(()=>{A()},[]);const De=async()=>{const r=u.code.trim();if(!r){i.error("Informe o código do cupom");return}const s=Number(u.percentOff);if(!Number.isFinite(s)||s<=0){i.error("Percentual inválido");return}try{pe(!0);const{error:t}=await v.functions.invoke("admin-stripe-coupon",{body:{action:"create",code:r,name:u.name.trim()||void 0,percentOff:s,maxRedemptions:u.maxRedemptions===""?void 0:Number(u.maxRedemptions),duration:u.duration,durationInMonths:u.duration==="repeating"&&u.durationInMonths!==""?Number(u.durationInMonths):void 0}});if(t)throw t;i.success("Cupom criado!"),q(!1),w({code:"",name:"",percentOff:10,maxRedemptions:"",duration:"once",durationInMonths:""}),await A()}catch{i.error("Erro ao criar cupom")}finally{pe(!1)}},xe=async(r,s)=>{try{const{error:t}=await v.functions.invoke("admin-stripe-coupon",{body:{action:"set_active",promotionCodeId:r,active:s}});if(t)throw t;await A()}catch{i.error("Erro ao atualizar cupom")}};l.useEffect(()=>{(async()=>{try{const{data:s,error:t}=await v.from("app_settings").select("value").eq("key","billing_settings").maybeSingle();if(t){k(null);return}const n=s?.value;typeof n?.free_usage_limit=="number"?k(n.free_usage_limit):k(null);const{data:p}=await v.from("app_settings").select("value").eq("key","trial_settings").maybeSingle(),m=p?.value;ae(typeof m?.enabled=="boolean"?m.enabled:!0),te(typeof m?.days=="number"&&Number.isFinite(m.days)?m.days:14),oe(!!m?.apply_to_existing_users)}catch{k(null)}})()},[]);const Ie=async()=>{const r=z===""?14:z,s=typeof r=="string"?Number(r):r;if(!Number.isInteger(s)||s<0){i.error("Duração do trial (dias) inválida");return}try{le(!0);const t={};typeof O=="number"&&(t.free_usage_limit=O);const{error:n}=await v.from("app_settings").upsert({key:"billing_settings",value:t},{onConflict:"key"});if(n)throw n;const{error:p}=await v.from("app_settings").upsert({key:"trial_settings",value:{enabled:M,days:s,apply_to_existing_users:D}},{onConflict:"key"});if(p)throw p;if(D||s<=0){const{data:N,error:j}=await v.rpc("apply_trial_settings_to_existing_trials");if(j)throw j;const T=typeof N=="number"?N:null,U=s<=0?"revogado":"recalculado";i.success(typeof T=="number"?`Configurações atualizadas! Trial ${U} para ${T} usuário(s).`:"Configurações atualizadas!");return}i.success("Configurações atualizadas!")}catch{i.error("Erro ao salvar configurações")}finally{le(!1)}},Ae=async()=>{const r=P(R)??a.price;if(!a.name){i.error("Informe o nome do plano");return}if(typeof r!="number"||!Number.isFinite(r)||r<=0){i.error("Preço inválido");return}const s=P(F),t=typeof s=="number"&&Number.isFinite(s)?s:null;if(t!==null&&t<=r){i.error("O preço original deve ser maior que o preço real");return}if(!L){i.error("Stripe não configurado. Defina STRIPE_SECRET_KEY no Supabase");return}a.interval||(a.interval="monthly"),ee(!0),console.log("AdminPlans: Iniciando salvamento de plano",{plan:a,isNew:!a.id});try{a.id?(await x(a.id,{...a,price:r,originalPrice:t}),console.log("AdminPlans: Plano atualizado com sucesso",{planId:a.id}),i.success("Plano atualizado!")):(await g({name:a.name,price:r,originalPrice:t,description:a.description||"",features:a.features||[],interval:a.interval||"monthly",color:a.color,isPopular:a.isPopular,gatewayId:a.gatewayId,trialDays:a.trialDays,allowCoupons:a.allowCoupons,usageLimit:a.usageLimit??null,allowedPages:a.allowedPages||[]}),console.log("AdminPlans: Plano criado com sucesso"),i.success("Plano criado!")),y(!1),d({}),S(""),E(""),B("general")}catch(n){console.error("AdminPlans: Erro ao salvar plano",{error:n});const p=n instanceof Error?n.message:String(n);i.error(`Erro ao salvar plano: ${p}`)}finally{ee(!1)}},ge=r=>{const s=r?{...r,features:(r.features||[]).map(t=>({...t,id:t.id||`feature-${Math.random().toString(36).substr(2,9)}`}))}:{features:[],color:"from-blue-500 to-cyan-500",price:void 0,interval:"monthly",isPopular:!1,trialDays:14,allowCoupons:!0,usageLimit:null,allowedPages:[]};d(s),S(typeof s.price=="number"&&Number.isFinite(s.price)?I(s.price):""),E(typeof s.originalPrice=="number"&&Number.isFinite(s.originalPrice)?I(s.originalPrice):""),B("general"),y(!0)},Te=()=>{d(r=>({...r,isPopular:!r.isPopular}))},fe=()=>{d(r=>({...r,features:[...r.features||[],{id:`feature-${(r.features||[]).length}-${Date.now()}`,text:"",included:!0}]}))},_e=(r,s,t)=>{d(n=>{const p=[...n.features||[]],m={...p[r]};return m[s]=t,p[r]=m,{...n,features:p}})},Re=r=>{d(s=>{const t=[...s.features||[]];return t.splice(r,1),{...s,features:t}})},Fe=async()=>{if(C){se(!0),console.log("AdminPlans: Iniciando remoção de plano",{planId:C});try{await f(C),console.log("AdminPlans: Plano removido com sucesso",{planId:C}),i.success("Plano removido!"),$(null)}catch(r){console.error("AdminPlans: Erro ao remover plano",{planId:C,error:r}),i.error("Erro ao remover plano")}finally{se(!1)}}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4 items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-1",children:"Planos & Assinaturas"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie os preços e funcionalidades."})]}),e.jsxs(h,{variant:"neon",onClick:()=>ge(),disabled:L===!1,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Novo Plano"]})]}),L===!1&&e.jsx(_,{className:"p-4 border border-yellow-500/20 bg-yellow-500/10",children:e.jsx("div",{className:"text-sm text-yellow-200",children:"Stripe não configurado. A aba de planos exige `STRIPE_SECRET_KEY` nos secrets do Supabase."})}),e.jsxs(_,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4 items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Limites do plano Free"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Defina quando bloquear e direcionar para assinatura."})]}),e.jsx(h,{variant:"glass",onClick:Ie,disabled:ne,children:ne?"Salvando...":"Salvar"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Limite mensal (ações)"}),e.jsx("input",{type:"number",min:0,value:O??"",onChange:r=>{const s=r.target.value;k(s===""?null:Number(s))},placeholder:"Ex: 20",className:"w-full p-3 rounded-xl bg-muted/30 border border-border"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Trial para novos usuários"}),e.jsxs("div",{className:"flex items-center gap-3 h-[48px] px-3 rounded-xl bg-muted/30 border border-border",children:[e.jsx(be,{id:"trial-enabled",checked:M,onCheckedChange:ae}),e.jsx(he,{htmlFor:"trial-enabled",children:"Ativar"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Trial para antigos usuários"}),e.jsxs("div",{className:"flex items-center gap-3 h-[48px] px-3 rounded-xl bg-muted/30 border border-border",children:[e.jsx(be,{id:"trial-existing-users",checked:D,onCheckedChange:oe}),e.jsx(he,{htmlFor:"trial-existing-users",children:"Aplicar ao alterar"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Duração do trial (dias)"}),e.jsx("input",{type:"number",min:0,value:z,onChange:r=>{const s=r.target.value;te(s===""?"":Number(s))},placeholder:"Ex: 14",className:"w-full p-3 rounded-xl bg-muted/30 border border-border",disabled:!M&&!D})]})]})]}),e.jsxs(_,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4 items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Cupons (Stripe)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Crie e ative/desative promo codes."})]}),e.jsxs("div",{className:"flex w-full sm:w-auto gap-3",children:[e.jsxs(h,{variant:"glass",onClick:A,disabled:ie,className:"w-full sm:w-auto",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),ie?"Atualizando...":"Atualizar"]}),e.jsxs(h,{variant:"neon",onClick:()=>q(!0),className:"w-full sm:w-auto",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Novo cupom"]})]})]}),e.jsx("div",{className:"mt-6 space-y-3",children:ce.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Nenhum cupom encontrado."}):ce.map(r=>e.jsxs("div",{className:"p-4 rounded-xl bg-muted/20 border border-border flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-semibold",children:[r.code,e.jsx("span",{className:`ml-2 text-xs px-2 py-0.5 rounded-full border ${r.active?"bg-green-500/10 border-green-500/20 text-green-300":"bg-red-500/10 border-red-500/20 text-red-300"}`,children:r.active?"Ativo":"Inativo"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[typeof r.coupon?.percent_off=="number"?`${r.coupon.percent_off}% off`:"-",r.max_redemptions?` • Máx: ${r.max_redemptions}`:"",typeof r.times_redeemed=="number"?` • Usos: ${r.times_redeemed}`:""]})]}),e.jsx("div",{className:"flex gap-2",children:r.active?e.jsx(h,{variant:"glass",onClick:()=>xe(r.id,!1),children:"Desativar"}):e.jsx(h,{variant:"neon",onClick:()=>xe(r.id,!0),children:"Ativar"})})]},r.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:c.map(r=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:`absolute -inset-0.5 bg-gradient-to-r ${r.color} rounded-2xl blur opacity-20 group-hover:opacity-60 transition duration-500`}),e.jsxs(_,{className:"relative h-full p-6 flex flex-col",children:[r.isPopular&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 px-3 py-1 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full text-[10px] font-bold uppercase tracking-wider text-white shadow-lg shadow-orange-500/20",children:"Mais Popular"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:r.name}),!r.gatewayId&&e.jsx("div",{className:"mt-2 inline-flex px-2 py-1 rounded-full bg-yellow-500/10 border border-yellow-500/20 text-[10px] font-semibold uppercase tracking-wider text-yellow-400",children:"Stripe não configurado"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 h-10",children:r.description})]}),e.jsxs("div",{className:"mb-6",children:[r.originalPrice&&r.originalPrice>r.price&&e.jsxs("span",{className:"text-lg text-muted-foreground line-through font-medium block",children:["R$ ",r.originalPrice.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("span",{className:"text-3xl font-bold",children:["R$ ",r.price.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("span",{className:"text-muted-foreground",children:["/",r.interval==="monthly"?"mês":"ano"]})]}),e.jsx("div",{className:"space-y-3 mb-8 flex-1",children:r.features.map(s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("div",{className:`p-1 rounded-full ${s.included?"bg-green-100 text-green-600 dark:bg-green-500/20 dark:text-green-400":"bg-red-100 text-red-600 dark:bg-red-500/10 dark:text-red-400 opacity-50"}`,children:s.included?e.jsx(J,{className:"w-3 h-3"}):e.jsx(je,{className:"w-3 h-3"})}),e.jsx("span",{className:s.included?"text-foreground":"text-muted-foreground line-through opacity-50",children:s.text})]},s.id))}),e.jsxs("div",{className:"flex gap-3 mt-auto",children:[e.jsx("button",{onClick:()=>ge(r),className:"flex-1 py-2 rounded-xl bg-muted/40 hover:bg-muted border border-border transition-colors text-sm font-medium",children:"Editar"}),e.jsx("button",{onClick:async()=>{try{await f(r.id),i.success("Plano removido!")}catch{i.error("Erro ao remover plano")}},className:"p-2 rounded-xl bg-red-100 text-red-600 hover:bg-red-200 dark:bg-red-500/10 dark:text-red-400 dark:hover:bg-red-500/20 transition-colors",children:e.jsx(ye,{className:"w-5 h-5"})})]})]})]},r.id))}),e.jsx(V,{open:b,onOpenChange:y,children:e.jsxs(Y,{className:"w-[95vw] sm:w-full max-w-4xl h-[90vh] sm:h-[85vh] flex flex-col p-0 gap-0 overflow-hidden bg-background/95 backdrop-blur-2xl border-border rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(H,{className:"sr-only",children:a.id?"Editar Plano":"Novo Plano"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold",children:a.id?"Editar Plano":"Novo Plano"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Configure os detalhes, preços e permissões."})]}),a.gatewayId&&e.jsxs("div",{className:"hidden sm:block text-[10px] text-muted-foreground bg-muted/50 px-2 py-1 rounded border border-border",children:["Stripe ID: ",e.jsx("span",{className:"font-mono",children:a.gatewayId})]})]}),e.jsxs(qe,{value:ke,onValueChange:B,className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"px-4 sm:px-6 pt-4 border-b border-border bg-muted/10",children:e.jsxs(Ue,{className:"w-full justify-start h-auto p-0 bg-transparent gap-2 sm:gap-6 overflow-x-auto no-scrollbar",children:[e.jsx(K,{value:"general",className:"rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent px-2 sm:px-4 py-2 text-xs sm:text-sm",children:"Geral & Preço"}),e.jsx(K,{value:"permissions",className:"rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent px-2 sm:px-4 py-2 text-xs sm:text-sm",children:"Permissões & Páginas"}),e.jsx(K,{value:"features",className:"rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent px-2 sm:px-4 py-2 text-xs sm:text-sm",children:"Funcionalidades"})]})}),e.jsx(Ve,{className:"flex-1",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs(W,{value:"general",className:"mt-0 space-y-6 focus-visible:outline-none",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Identificação"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nome do Plano"}),e.jsx("input",{value:a.name||"",onChange:r=>d({...a,name:r.target.value}),placeholder:"Ex: Profissional",className:"w-full p-3 rounded-xl bg-muted/30 border border-border focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Descrição Curta"}),e.jsx("input",{value:a.description||"",onChange:r=>d({...a,description:r.target.value}),placeholder:"Ex: Para usuários avançados",className:"w-full p-3 rounded-xl bg-muted/30 border border-border focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"})]})]})]}),e.jsx(Q,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Preços e Cobrança"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Preço (R$)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"R$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:R,onChange:r=>{const s=r.target.value;S(s);const t=P(s);d(n=>({...n,price:t??void 0}))},onBlur:()=>{const r=P(R);typeof r=="number"&&Number.isFinite(r)&&r>0&&S(I(r))},placeholder:"0,00",className:"w-full p-3 pl-10 rounded-xl bg-muted/30 border border-border focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Preço Original (R$) ",e.jsx("span",{className:"text-xs text-muted-foreground font-normal",children:"(Fictício)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"R$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:F,onChange:r=>{const s=r.target.value;E(s);const t=P(s);d(n=>({...n,originalPrice:t??void 0}))},onBlur:()=>{const r=P(F);typeof r=="number"&&Number.isFinite(r)&&r>0&&E(I(r))},placeholder:"0,00",className:"w-full p-3 pl-10 rounded-xl bg-muted/30 border border-border focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Deve ser maior que o preço real."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Intervalo"}),e.jsxs("select",{value:a.interval||"monthly",onChange:r=>d({...a,interval:r.target.value}),className:"w-full p-3 rounded-xl bg-muted/30 border border-border text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",children:[e.jsx("option",{value:"monthly",children:"Mensal"}),e.jsx("option",{value:"yearly",children:"Anual"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status Popular"}),e.jsxs("button",{type:"button",onClick:Te,className:`w-full flex items-center justify-center gap-2 p-3 rounded-xl border text-sm font-medium transition-all ${a.isPopular?"bg-yellow-500/10 text-yellow-600 border-yellow-500/50":"bg-muted/30 text-muted-foreground border-border hover:bg-muted/50"}`,children:[e.jsx(ve,{className:`w-4 h-4 ${a.isPopular?"fill-yellow-600":""}`}),a.isPopular?"É Popular":"Não é Popular"]})]})]})]}),e.jsx(Q,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Limites e Testes"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Período de Teste (Dias)"}),e.jsx("input",{type:"number",min:0,value:isNaN(a.trialDays??14)?"":a.trialDays??14,onChange:r=>d({...a,trialDays:r.target.value===""?NaN:Number(r.target.value)}),className:"w-full p-3 rounded-xl bg-muted/30 border border-border focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Limite de Uso (Mensal)"}),e.jsx("input",{type:"number",min:0,value:a.usageLimit??"",onChange:r=>d({...a,usageLimit:r.target.value===""?null:Number(r.target.value)}),placeholder:"Ilimitado",className:"w-full p-3 rounded-xl bg-muted/30 border border-border focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-xl border border-border bg-muted/10 cursor-pointer hover:bg-muted/20 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:a.allowCoupons??!0,onChange:()=>d(r=>({...r,allowCoupons:!(r.allowCoupons??!0)})),className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium block",children:"Permitir Cupons"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Usuários podem aplicar cupons de desconto neste plano."})]})]})})]})]}),e.jsx(W,{value:"permissions",className:"mt-0 space-y-6 focus-visible:outline-none",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Acesso às Páginas"}),e.jsx("button",{type:"button",onClick:()=>{const r=G.map(n=>n.id),s=a.allowedPages||[],t=r.every(n=>s.includes(n));d({...a,allowedPages:t?[]:r})},className:"text-xs text-primary hover:underline",children:(a.allowedPages?.length||0)===G.length?"Desmarcar todos":"Marcar todos"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:G.map(r=>{const s=(a.allowedPages||[]).includes(r.id);return e.jsxs("button",{type:"button",onClick:()=>{const t=a.allowedPages||[],n=s?t.filter(p=>p!==r.id):[...t,r.id];d({...a,allowedPages:n})},className:`relative group flex items-start gap-3 p-3 rounded-xl border text-left transition-all ${s?"bg-primary/5 border-primary/20 shadow-sm":"bg-card border-border hover:border-primary/20 hover:bg-muted/50"}`,children:[e.jsx("div",{className:`mt-0.5 w-5 h-5 rounded border flex items-center justify-center transition-colors ${s?"bg-primary border-primary text-primary-foreground":"border-muted-foreground/30 bg-background"}`,children:s&&e.jsx(J,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:`text-sm font-medium block truncate ${s?"text-foreground":"text-muted-foreground"}`,children:r.label}),e.jsx("span",{className:"text-[10px] text-muted-foreground truncate block opacity-70",children:r.id})]})]},r.id)})})]})}),e.jsx(W,{value:"features",className:"mt-0 space-y-6 focus-visible:outline-none",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:"Lista de Funcionalidades"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"O que será exibido no card do plano."})]}),e.jsxs(h,{onClick:fe,className:"h-8 text-xs",children:[e.jsx(X,{className:"w-3 h-3 mr-1"})," Adicionar"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(He,{axis:"y",values:a.features||[],onReorder:r=>d(s=>({...s,features:r})),className:"space-y-3",children:(a.features||[]).map((r,s)=>e.jsx(tr,{feature:r,index:s,handleUpdateFeature:_e,handleRemoveFeature:Re},r.id))}),(a.features||[]).length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center border-2 border-dashed border-border rounded-xl bg-muted/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted/20 flex items-center justify-center mb-3",children:e.jsx(ve,{className:"w-6 h-6 text-muted-foreground/50"})}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nenhuma funcionalidade adicionada"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1",children:"Adicione itens para mostrar os benefícios deste plano."}),e.jsx("button",{onClick:fe,className:"mt-4 text-xs text-primary hover:underline",children:"Adicionar primeira funcionalidade"})]})]})]})})]})})]}),e.jsxs("div",{className:"p-4 sm:p-6 border-t border-border bg-background/50 backdrop-blur-xl flex flex-col sm:flex-row items-center gap-4 justify-between",children:[e.jsx("div",{className:"text-xs text-muted-foreground hidden sm:block",children:a.id?"Editando plano existente":"Criando novo plano"}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row w-full sm:w-auto gap-3",children:[e.jsx("button",{onClick:()=>y(!1),className:"flex-1 sm:flex-none px-4 py-2 rounded-xl border border-border hover:bg-muted transition-colors text-sm font-medium",children:"Cancelar"}),e.jsx(h,{onClick:Ae,className:"flex-1 sm:flex-none min-w-[120px]",disabled:Z,children:Z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2"}),"Salvando..."]}):"Salvar Alterações"})]})]})]})}),e.jsx(V,{open:Ee,onOpenChange:q,children:e.jsxs(Y,{className:"w-[95vw] sm:w-full max-w-lg max-h-[90vh] overflow-y-auto bg-background/95 backdrop-blur-2xl border-border",children:[e.jsx(H,{className:"sr-only",children:"Novo cupom"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Novo cupom"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{value:u.code,onChange:r=>w(s=>({...s,code:r.target.value})),placeholder:"Código (ex: AYLL10)",className:"w-full p-3 rounded-xl bg-muted/30 border border-border"}),e.jsx("input",{value:u.name,onChange:r=>w(s=>({...s,name:r.target.value})),placeholder:"Nome (opcional)",className:"w-full p-3 rounded-xl bg-muted/30 border border-border"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",min:1,max:100,value:u.percentOff,onChange:r=>{const s=r.target.value;w(t=>({...t,percentOff:s===""?"":Number(s)}))},placeholder:"% off",className:"w-full p-3 rounded-xl bg-muted/30 border border-border"}),e.jsx("input",{type:"number",min:1,value:u.maxRedemptions,onChange:r=>w(s=>({...s,maxRedemptions:r.target.value})),placeholder:"Máx. resgates (opcional)",className:"w-full p-3 rounded-xl bg-muted/30 border border-border"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("select",{value:u.duration,onChange:r=>w(s=>({...s,duration:r.target.value})),className:"w-full p-3 rounded-xl bg-muted/30 border border-border text-sm",children:[e.jsx("option",{value:"once",children:"Uma vez"}),e.jsx("option",{value:"repeating",children:"Repetindo"}),e.jsx("option",{value:"forever",children:"Para sempre"})]}),e.jsx("input",{type:"number",min:1,value:u.durationInMonths,onChange:r=>w(s=>({...s,durationInMonths:r.target.value})),disabled:u.duration!=="repeating",placeholder:"Meses (se repetindo)",className:"w-full p-3 rounded-xl bg-muted/30 border border-border"})]}),e.jsx(h,{onClick:De,className:"w-full",disabled:me,children:me?"Criando...":"Criar cupom"})]})]})}),e.jsx(V,{open:!!C,onOpenChange:r=>!r&&$(null),children:e.jsxs(Y,{className:"w-[95vw] sm:w-full max-w-md max-h-[90vh] overflow-y-auto bg-background/95 backdrop-blur-2xl border-border",children:[e.jsxs(ze,{children:[e.jsx(H,{children:"Excluir Plano"}),e.jsx(Be,{children:"Tem certeza que deseja excluir este plano? Esta ação não pode ser desfeita."})]}),e.jsxs(Ge,{className:"gap-2 sm:gap-0 flex flex-col-reverse sm:flex-row",children:[e.jsx("button",{onClick:()=>$(null),className:"px-4 py-2 rounded-xl border border-border hover:bg-muted transition-colors text-sm font-medium",children:"Cancelar"}),e.jsx(h,{onClick:Fe,disabled:re,className:"bg-red-500 hover:bg-red-600 text-white border-red-600 hover:border-red-700 shadow-red-500/20",children:re?"Excluindo...":"Excluir"})]})]})})]})}export{Cr as default};
