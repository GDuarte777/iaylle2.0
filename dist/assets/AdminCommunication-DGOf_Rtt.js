import{j as g,I as D,H as p,o as s,ad as oe,N as q}from"./index-D9dO6jDR.js";import{G as Q}from"./GlassCard-3LL1uNH4.js";import{I as H}from"./input-B-CVJ1EK.js";import{S as B}from"./switch-CpBR6YKs.js";import{L as O}from"./label-oZkRqp9j.js";import{T as ce}from"./textarea-CaGXNRBe.js";import{S as ue,a as de,b as le,c as fe,d as P}from"./select-CW8OCjh3.js";import{T as me,a as he,b as L,c as T,d as ge,e as k}from"./table-Dt-GE31l.js";import{P as xe}from"./plus-B0uAgXLJ.js";import{g as C,t as x,c as S,n as we,a as X,m as pe,b as Z,e as ye}from"./en-US-DfnapdEA.js";import{T as be}from"./trash-2-C6TvX7gl.js";import"./index-B6rWjmp5.js";import"./index-CurXoWR1.js";import"./index-BdQq_4o_.js";import"./index-CfA0gxda.js";import"./index-CQKvY29V.js";import"./chevron-down-CqRsxq5z.js";import"./check-DPcULkwW.js";function N(t,e){const r=C(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,a=x(t,e?.in),i=a.getDay(),u=(i<n?7:0)+i-n;return a.setDate(a.getDate()-u),a.setHours(0,0,0,0),a}function E(t,e){return N(t,{...e,weekStartsOn:1})}function z(t,e){const r=x(t,e?.in),n=r.getFullYear(),a=S(r,0);a.setFullYear(n+1,0,4),a.setHours(0,0,0,0);const i=E(a),u=S(r,0);u.setFullYear(n,0,4),u.setHours(0,0,0,0);const h=E(u);return r.getTime()>=i.getTime()?n+1:r.getTime()>=h.getTime()?n:n-1}function R(t,e){const r=x(t,e?.in);return r.setHours(0,0,0,0),r}function ve(t,e,r){const[n,a]=we(r?.in,t,e),i=R(n),u=R(a),h=+i-X(i),f=+u-X(u);return Math.round((h-f)/pe)}function Oe(t,e){const r=z(t,e),n=S(t,0);return n.setFullYear(r,0,4),n.setHours(0,0,0,0),E(n)}function je(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Se(t){return!(!je(t)&&typeof t!="number"||isNaN(+x(t)))}function Te(t,e){const r=x(t,e?.in);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}function ke(t,e){const r=x(t,e?.in);return ve(r,Te(r))+1}function Ne(t,e){const r=x(t,e?.in),n=+E(r)-+Oe(r);return Math.round(n/Z)+1}function ee(t,e){const r=x(t,e?.in),n=r.getFullYear(),a=C(),i=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,u=S(e?.in||t,0);u.setFullYear(n+1,0,i),u.setHours(0,0,0,0);const h=N(u,e),f=S(e?.in||t,0);f.setFullYear(n,0,i),f.setHours(0,0,0,0);const b=N(f,e);return+r>=+h?n+1:+r>=+b?n:n-1}function Me(t,e){const r=C(),n=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,a=ee(t,e),i=S(e?.in||t,0);return i.setFullYear(a,0,n),i.setHours(0,0,0,0),N(i,e)}function Ye(t,e){const r=x(t,e?.in),n=+N(r,e)-+Me(r,e);return Math.round(n/Z)+1}function c(t,e){const r=t<0?"-":"",n=Math.abs(t).toString().padStart(e,"0");return r+n}const w={y(t,e){const r=t.getFullYear(),n=r>0?r:1-r;return c(e==="yy"?n%100:n,e.length)},M(t,e){const r=t.getMonth();return e==="M"?String(r+1):c(r+1,2)},d(t,e){return c(t.getDate(),e.length)},a(t,e){const r=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];default:return r==="am"?"a.m.":"p.m."}},h(t,e){return c(t.getHours()%12||12,e.length)},H(t,e){return c(t.getHours(),e.length)},m(t,e){return c(t.getMinutes(),e.length)},s(t,e){return c(t.getSeconds(),e.length)},S(t,e){const r=e.length,n=t.getMilliseconds(),a=Math.trunc(n*Math.pow(10,r-3));return c(a,e.length)}},j={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},$={G:function(t,e,r){const n=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});default:return r.era(n,{width:"wide"})}},y:function(t,e,r){if(e==="yo"){const n=t.getFullYear(),a=n>0?n:1-n;return r.ordinalNumber(a,{unit:"year"})}return w.y(t,e)},Y:function(t,e,r,n){const a=ee(t,n),i=a>0?a:1-a;if(e==="YY"){const u=i%100;return c(u,2)}return e==="Yo"?r.ordinalNumber(i,{unit:"year"}):c(i,e.length)},R:function(t,e){const r=z(t);return c(r,e.length)},u:function(t,e){const r=t.getFullYear();return c(r,e.length)},Q:function(t,e,r){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return c(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,e,r){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return c(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,e,r){const n=t.getMonth();switch(e){case"M":case"MM":return w.M(t,e);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(t,e,r){const n=t.getMonth();switch(e){case"L":return String(n+1);case"LL":return c(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(t,e,r,n){const a=Ye(t,n);return e==="wo"?r.ordinalNumber(a,{unit:"week"}):c(a,e.length)},I:function(t,e,r){const n=Ne(t);return e==="Io"?r.ordinalNumber(n,{unit:"week"}):c(n,e.length)},d:function(t,e,r){return e==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):w.d(t,e)},D:function(t,e,r){const n=ke(t);return e==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):c(n,e.length)},E:function(t,e,r){const n=t.getDay();switch(e){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(t,e,r,n){const a=t.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return c(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(a,{width:"short",context:"formatting"});default:return r.day(a,{width:"wide",context:"formatting"})}},c:function(t,e,r,n){const a=t.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return c(i,e.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(a,{width:"narrow",context:"standalone"});case"cccccc":return r.day(a,{width:"short",context:"standalone"});default:return r.day(a,{width:"wide",context:"standalone"})}},i:function(t,e,r){const n=t.getDay(),a=n===0?7:n;switch(e){case"i":return String(a);case"ii":return c(a,e.length);case"io":return r.ordinalNumber(a,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(t,e,r){const a=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(a,{width:"narrow",context:"formatting"});default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(t,e,r){const n=t.getHours();let a;switch(n===12?a=j.noon:n===0?a=j.midnight:a=n/12>=1?"pm":"am",e){case"b":case"bb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(a,{width:"narrow",context:"formatting"});default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(t,e,r){const n=t.getHours();let a;switch(n>=17?a=j.evening:n>=12?a=j.afternoon:n>=4?a=j.morning:a=j.night,e){case"B":case"BB":case"BBB":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(a,{width:"narrow",context:"formatting"});default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(t,e,r){if(e==="ho"){let n=t.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return w.h(t,e)},H:function(t,e,r){return e==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):w.H(t,e)},K:function(t,e,r){const n=t.getHours()%12;return e==="Ko"?r.ordinalNumber(n,{unit:"hour"}):c(n,e.length)},k:function(t,e,r){let n=t.getHours();return n===0&&(n=24),e==="ko"?r.ordinalNumber(n,{unit:"hour"}):c(n,e.length)},m:function(t,e,r){return e==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):w.m(t,e)},s:function(t,e,r){return e==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):w.s(t,e)},S:function(t,e){return w.S(t,e)},X:function(t,e,r){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return J(n);case"XXXX":case"XX":return y(n);default:return y(n,":")}},x:function(t,e,r){const n=t.getTimezoneOffset();switch(e){case"x":return J(n);case"xxxx":case"xx":return y(n);default:return y(n,":")}},O:function(t,e,r){const n=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+V(n,":");default:return"GMT"+y(n,":")}},z:function(t,e,r){const n=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+V(n,":");default:return"GMT"+y(n,":")}},t:function(t,e,r){const n=Math.trunc(+t/1e3);return c(n,e.length)},T:function(t,e,r){return c(+t,e.length)}};function V(t,e=""){const r=t>0?"-":"+",n=Math.abs(t),a=Math.trunc(n/60),i=n%60;return i===0?r+String(a):r+String(a)+e+c(i,2)}function J(t,e){return t%60===0?(t>0?"-":"+")+c(Math.abs(t)/60,2):y(t,e)}function y(t,e=""){const r=t>0?"-":"+",n=Math.abs(t),a=c(Math.trunc(n/60),2),i=c(n%60,2);return r+a+e+i}const K=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});default:return e.date({width:"full"})}},te=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});default:return e.time({width:"full"})}},De=(t,e)=>{const r=t.match(/(P+)(p+)?/)||[],n=r[1],a=r[2];if(!a)return K(t,e);let i;switch(n){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",K(n,e)).replace("{{time}}",te(a,e))},Pe={p:te,P:De},Ee=/^D+$/,Ce=/^Y+$/,We=["D","DD","YY","YYYY"];function qe(t){return Ee.test(t)}function He(t){return Ce.test(t)}function _e(t,e,r){const n=Fe(t,e,r);if(console.warn(n),We.includes(t))throw new RangeError(n)}function Fe(t,e,r){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Ge=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ie=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ae=/^'([^]*?)'?$/,Qe=/''/g,Be=/[a-zA-Z]/;function U(t,e,r){const n=C(),a=n.locale??ye,i=n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,u=n.weekStartsOn??n.locale?.options?.weekStartsOn??0,h=x(t,r?.in);if(!Se(h))throw new RangeError("Invalid time value");let f=e.match(Ie).map(l=>{const d=l[0];if(d==="p"||d==="P"){const v=Pe[d];return v(l,a.formatLong)}return l}).join("").match(Ge).map(l=>{if(l==="''")return{isToken:!1,value:"'"};const d=l[0];if(d==="'")return{isToken:!1,value:Le(l)};if($[d])return{isToken:!0,value:l};if(d.match(Be))throw new RangeError("Format string contains an unescaped latin alphabet character `"+d+"`");return{isToken:!1,value:l}});a.localize.preprocessor&&(f=a.localize.preprocessor(h,f));const b={firstWeekContainsDate:i,weekStartsOn:u,locale:a};return f.map(l=>{if(!l.isToken)return l.value;const d=l.value;(He(d)||qe(d))&&_e(d,e,String(t));const v=$[d[0]];return v(h,d,a.localize,b)}).join("")}function Le(t){const e=t.match(Ae);return e?e[1].replace(Qe,"'"):t}function ut(){const[t,e]=g.useState(!0),[r,n]=g.useState([]),[a,i]=g.useState(!1),[u,h]=g.useState(""),[f,b]=g.useState(""),[l,d]=g.useState("info"),[v,_]=g.useState(!0),[F,G]=g.useState(""),[I,A]=g.useState(""),M=g.useCallback(async()=>{e(!0);try{const{data:o,error:m}=await D.from("system_announcements").select("*").order("created_at",{ascending:!1});if(m)throw m;n(o??[])}catch(o){console.error(o),p.error("Erro ao carregar avisos")}finally{e(!1)}},[]);g.useEffect(()=>{M()},[M]);const re=async()=>{if(!u||!f){p.error("Preencha título e mensagem");return}try{const o={title:u,message:f,type:l,active:v,start_at:F||new Date().toISOString(),end_at:I||null},{error:m}=await D.from("system_announcements").insert(o);if(m)throw m;p.success("Aviso criado com sucesso!"),i(!1),se(),await M()}catch(o){console.error(o),p.error("Erro ao criar aviso")}},ne=async o=>{if(confirm("Tem certeza que deseja excluir este aviso?"))try{const{error:m}=await D.from("system_announcements").delete().eq("id",o);if(m)throw m;p.success("Aviso excluído"),await M()}catch(m){console.error(m),p.error("Erro ao excluir aviso")}},ae=async(o,m)=>{try{const{error:Y}=await D.from("system_announcements").update({active:!m}).eq("id",o);if(Y)throw Y;n(ie=>ie.map(W=>W.id===o?{...W,active:!m}:W))}catch(Y){console.error(Y),p.error("Erro ao atualizar status")}},se=()=>{h(""),b(""),d("info"),_(!0),G(""),A("")};return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-3",children:[s.jsx(oe,{className:"w-8 h-8 text-purple-600 dark:text-purple-400"}),"Central de Comunicação"]}),s.jsx("p",{className:"text-muted-foreground",children:"Gerencie avisos e notificações globais para os usuários."})]}),s.jsx(q,{variant:"neon",onClick:()=>i(!a),className:"gap-2",children:a?"Cancelar":s.jsxs(s.Fragment,{children:[s.jsx(xe,{className:"w-4 h-4"})," Novo Aviso"]})})]}),a&&s.jsxs(Q,{className:"p-6 animate-in slide-in-from-top-4",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Novo Aviso"}),s.jsxs("div",{className:"grid gap-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(O,{children:"Título"}),s.jsx(H,{value:u,onChange:o=>h(o.target.value),placeholder:"Ex: Manutenção Programada"})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(O,{children:"Mensagem"}),s.jsx(ce,{value:f,onChange:o=>b(o.target.value),placeholder:"Ex: O sistema ficará instável entre 02:00 e 04:00..."})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(O,{children:"Tipo"}),s.jsxs(ue,{value:l,onValueChange:o=>d(o),children:[s.jsx(de,{children:s.jsx(le,{})}),s.jsxs(fe,{children:[s.jsx(P,{value:"info",children:"Informação (Azul)"}),s.jsx(P,{value:"warning",children:"Alerta (Amarelo)"}),s.jsx(P,{value:"success",children:"Sucesso (Verde)"}),s.jsx(P,{value:"danger",children:"Perigo (Vermelho)"})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 pt-8",children:[s.jsx(B,{checked:v,onCheckedChange:_}),s.jsx(O,{children:"Ativo imediatamente"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(O,{children:"Início (opcional)"}),s.jsx(H,{type:"datetime-local",value:F,onChange:o=>G(o.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(O,{children:"Fim (opcional)"}),s.jsx(H,{type:"datetime-local",value:I,onChange:o=>A(o.target.value)})]})]}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsx(q,{variant:"neon",onClick:re,children:"Publicar Aviso"})})]})]}),s.jsx(Q,{className:"p-6",children:t?s.jsx("div",{className:"py-10 text-center text-muted-foreground",children:"Carregando..."}):r.length===0?s.jsx("div",{className:"py-10 text-center text-muted-foreground",children:"Nenhum aviso encontrado."}):s.jsxs(me,{children:[s.jsx(he,{children:s.jsxs(L,{children:[s.jsx(T,{children:"Status"}),s.jsx(T,{children:"Aviso"}),s.jsx(T,{children:"Tipo"}),s.jsx(T,{children:"Vigência"}),s.jsx(T,{className:"text-right",children:"Ações"})]})}),s.jsx(ge,{children:r.map(o=>s.jsxs(L,{children:[s.jsx(k,{children:s.jsx(B,{checked:o.active,onCheckedChange:()=>ae(o.id,o.active)})}),s.jsx(k,{children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"font-medium",children:o.title}),s.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[300px]",children:o.message})]})}),s.jsx(k,{children:s.jsx("span",{className:`text-xs px-2 py-1 rounded-full border capitalize ${o.type==="info"?"bg-blue-500/10 text-blue-500 border-blue-500/20":o.type==="warning"?"bg-yellow-500/10 text-yellow-500 border-yellow-500/20":o.type==="success"?"bg-green-500/10 text-green-500 border-green-500/20":"bg-red-500/10 text-red-500 border-red-500/20"}`,children:o.type})}),s.jsx(k,{children:s.jsxs("div",{className:"flex flex-col text-xs text-muted-foreground",children:[s.jsxs("span",{children:["Início: ",o.start_at?U(new Date(o.start_at),"dd/MM/yyyy HH:mm"):"Imediato"]}),s.jsxs("span",{children:["Fim: ",o.end_at?U(new Date(o.end_at),"dd/MM/yyyy HH:mm"):"Indeterminado"]})]})}),s.jsx(k,{className:"text-right",children:s.jsx(q,{variant:"glass",className:"h-8 w-8 p-0 text-destructive hover:text-destructive",onClick:()=>ne(o.id),children:s.jsx(be,{className:"w-4 h-4"})})})]},o.id))})]})})]})}export{ut as default};
