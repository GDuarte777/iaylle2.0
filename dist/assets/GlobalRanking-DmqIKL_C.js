import{c as X,j as i,o as e,az as Z,aA as _,q as A,B as ee,I as y,H as k,Y as ae,T as E,a9 as te,a2 as re,a3 as se,a4 as ne,C as oe}from"./index-D9dO6jDR.js";import{G as L}from"./GlassCard-3LL1uNH4.js";import{c as ie}from"./index-CurXoWR1.js";import{r as le}from"./index-DD1lgNRl.js";import{B as P}from"./button-BiTOCxHO.js";import{S as ce}from"./switch-CpBR6YKs.js";import{S as N}from"./skeleton-ChwvLWzH.js";import"./index-B6rWjmp5.js";const de=[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]],I=X("medal",de);function ue(a,t=[]){let n=[];function l(s,c){const o=i.createContext(c);o.displayName=s+"Context";const u=n.length;n=[...n,c];const m=p=>{const{scope:b,children:h,...f}=p,v=b?.[a]?.[u]||o,S=i.useMemo(()=>f,Object.values(f));return e.jsx(v.Provider,{value:S,children:h})};m.displayName=s+"Provider";function g(p,b){const h=b?.[a]?.[u]||o,f=i.useContext(h);if(f)return f;if(c!==void 0)return c;throw new Error(`\`${p}\` must be used within \`${s}\``)}return[m,g]}const d=()=>{const s=n.map(c=>i.createContext(c));return function(o){const u=o?.[a]||s;return i.useMemo(()=>({[`__scope${a}`]:{...o,[a]:u}}),[o,u])}};return d.scopeName=a,[l,me(d,...t)]}function me(...a){const t=a[0];if(a.length===1)return t;const n=()=>{const l=a.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(s){const c=l.reduce((o,{useScope:u,scopeName:m})=>{const p=u(s)[`__scope${m}`];return{...o,...p}},{});return i.useMemo(()=>({[`__scope${t.scopeName}`]:c}),[c])}};return n.scopeName=t.scopeName,n}var pe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],C=pe.reduce((a,t)=>{const n=ie(`Primitive.${t}`),l=i.forwardRef((d,s)=>{const{asChild:c,...o}=d,u=c?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(u,{...o,ref:s})});return l.displayName=`Primitive.${t}`,{...a,[t]:l}},{}),xe=le();function fe(){return xe.useSyncExternalStore(ge,()=>!0,()=>!1)}function ge(){return()=>{}}var R="Avatar",[he]=ue(R),[ve,$]=he(R),q=i.forwardRef((a,t)=>{const{__scopeAvatar:n,...l}=a,[d,s]=i.useState("idle");return e.jsx(ve,{scope:n,imageLoadingStatus:d,onImageLoadingStatusChange:s,children:e.jsx(C.span,{...l,ref:t})})});q.displayName=R;var G="AvatarImage",z=i.forwardRef((a,t)=>{const{__scopeAvatar:n,src:l,onLoadingStatusChange:d=()=>{},...s}=a,c=$(G,n),o=be(l,s),u=Z(m=>{d(m),c.onImageLoadingStatusChange(m)});return _(()=>{o!=="idle"&&u(o)},[o,u]),o==="loaded"?e.jsx(C.img,{...s,ref:t,src:l}):null});z.displayName=G;var T="AvatarFallback",B=i.forwardRef((a,t)=>{const{__scopeAvatar:n,delayMs:l,...d}=a,s=$(T,n),[c,o]=i.useState(l===void 0);return i.useEffect(()=>{if(l!==void 0){const u=window.setTimeout(()=>o(!0),l);return()=>window.clearTimeout(u)}},[l]),c&&s.imageLoadingStatus!=="loaded"?e.jsx(C.span,{...d,ref:t}):null});B.displayName=T;function M(a,t){return a?t?(a.src!==t&&(a.src=t),a.complete&&a.naturalWidth>0?"loaded":"loading"):"error":"idle"}function be(a,{referrerPolicy:t,crossOrigin:n}){const l=fe(),d=i.useRef(null),s=l?(d.current||(d.current=new window.Image),d.current):null,[c,o]=i.useState(()=>M(s,a));return _(()=>{o(M(s,a))},[s,a]),_(()=>{const u=p=>()=>{o(p)};if(!s)return;const m=u("loaded"),g=u("error");return s.addEventListener("load",m),s.addEventListener("error",g),t&&(s.referrerPolicy=t),typeof n=="string"&&(s.crossOrigin=n),()=>{s.removeEventListener("load",m),s.removeEventListener("error",g)}},[s,n,t]),c}var F=q,U=z,V=B;const D=i.forwardRef(({className:a,...t},n)=>e.jsx(F,{ref:n,className:A("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...t}));D.displayName=F.displayName;const H=i.forwardRef(({className:a,...t},n)=>e.jsx(U,{ref:n,className:A("aspect-square h-full w-full",a),...t}));H.displayName=U.displayName;const O=i.forwardRef(({className:a,...t},n)=>e.jsx(V,{ref:n,className:A("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...t}));O.displayName=V.displayName;function Re(){const{user:a}=ee(),[t,n]=i.useState(!1),[l,d]=i.useState([]),[s,c]=i.useState(!0),[o,u]=i.useState(1),[m,g]=i.useState(0),p=20;i.useEffect(()=>{a&&b()},[a]),i.useEffect(()=>{h()},[o,t]);const b=async()=>{if(a)try{const{data:r,error:x}=await y.from("profiles").select("participating_in_ranking").eq("id",a.id).single();if(x)throw x;n(r?.participating_in_ranking||!1)}catch(r){console.error("Error checking participation status:",r)}},h=async()=>{c(!0);try{const[{data:r,error:x},{data:w,error:j}]=await Promise.all([y.rpc("get_global_ranking_count"),y.rpc("get_global_ranking",{p_page:o,p_page_size:p})]);if(x)throw x;if(j)throw j;g(typeof r=="number"?r:0);const K=(o-1)*p,Y=(w||[]).map((J,Q)=>({...J,rank:K+Q+1}));d(Y)}catch(r){console.error("Error fetching ranking:",r),k.error("Erro ao carregar ranking")}finally{c(!1)}},f=async r=>{if(!a)return;const x=t;n(r);try{const{data:w,error:j}=await y.rpc("set_ranking_participation",{p_enabled:r});if(j)throw j;n(!!w),k.success(r?"Você entrou no ranking!":"Você saiu do ranking."),h()}catch(w){console.error("Error updating participation:",w),n(x),k.error("Erro ao atualizar status de participação")}},v=Math.ceil(m/p),S=r=>r===1?e.jsx(oe,{className:"w-6 h-6 text-yellow-500 fill-yellow-500 animate-bounce"}):r===2?e.jsx(I,{className:"w-6 h-6 text-gray-300 fill-gray-300"}):r===3?e.jsx(I,{className:"w-6 h-6 text-amber-700 fill-amber-700"}):e.jsxs("span",{className:"font-bold text-muted-foreground w-6 text-center",children:[r,"º"]}),W=r=>r===1?"bg-gradient-to-r from-yellow-500/10 to-transparent border-yellow-500/30":r===2?"bg-gradient-to-r from-gray-300/10 to-transparent border-gray-300/30":r===3?"bg-gradient-to-r from-amber-700/10 to-transparent border-amber-700/30":"hover:bg-white/5";return e.jsx(ae,{children:e.jsxs("div",{className:"p-4 md:p-6 lg:p-8 max-w-7xl mx-auto space-y-6 md:space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold mb-2 flex items-center gap-3",children:[e.jsx(E,{className:"w-8 h-8 md:w-10 md:h-10 text-primary animate-pulse"}),"Ranking Global"]}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground max-w-2xl",children:"Veja as maiores guildas da plataforma e acompanhe seu desempenho em relação a outras gestoras. O ranking é baseado na quantidade de afiliados ativos."})]}),e.jsxs(L,{className:"p-4 flex items-center gap-4 border-l-4 border-l-primary w-full md:w-auto",children:[e.jsx("div",{className:`p-3 rounded-full ${t?"bg-green-500/10":"bg-muted"}`,children:e.jsx(te,{className:`w-6 h-6 ${t?"text-green-500":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-sm md:text-base",children:t?"Sair do Ranking":"Participar do Ranking Guildas"}),e.jsx(ce,{checked:t,onCheckedChange:f,"aria-label":t?"Sair do Ranking":"Participar do Ranking Guildas"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?"Seu perfil está visível para todos":"Ative para comparar seu desempenho"})]})]})]}),e.jsxs(L,{className:"overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-border/50",children:e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),"Top Guildas"]})}),e.jsx("div",{className:"divide-y divide-border/50",children:s?Array.from({length:5}).map((r,x)=>e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsx(N,{className:"w-8 h-8 rounded-full"}),e.jsx(N,{className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(N,{className:"h-4 w-1/3"}),e.jsx(N,{className:"h-3 w-1/4"})]}),e.jsx(N,{className:"h-8 w-20 rounded-full"})]},x)):l.length===0?e.jsxs("div",{className:"p-12 text-center text-muted-foreground",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"Nenhuma guilda encontrada no ranking."}),!t&&e.jsx("p",{className:"text-sm mt-2 text-primary cursor-pointer hover:underline",onClick:()=>f(!0),children:"Seja o primeiro a participar!"})]}):l.map(r=>e.jsxs("div",{className:`p-4 flex items-center gap-4 transition-colors ${W(r.rank)} ${a?.id===r.id?"bg-primary/5 border-l-2 border-l-primary":""}`,children:[e.jsx("div",{className:"flex-shrink-0 w-8 flex justify-center",children:S(r.rank)}),e.jsxs(D,{className:"w-10 h-10 md:w-12 md:h-12 border-2 border-background shadow-sm",children:[e.jsx(H,{src:r.avatar_url||""}),e.jsx(O,{className:"bg-primary/10 text-primary font-bold",children:r.full_name?.charAt(0).toUpperCase()||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:r.full_name||"Usuário Anônimo"}),a?.id===r.id&&e.jsx("span",{className:"text-[10px] bg-primary/20 text-primary px-2 py-0.5 rounded-full font-bold",children:"VOCÊ"})]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:"Líder de Guilda"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg md:text-xl font-bold text-foreground",children:r.active_affiliates_count}),e.jsx("div",{className:"text-[10px] md:text-xs text-muted-foreground uppercase tracking-wider",children:"Afiliados Ativos"})]})]},r.id))}),v>1&&e.jsxs("div",{className:"p-4 border-t border-border/50 flex items-center justify-between",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>u(r=>Math.max(1,r-1)),disabled:o===1||s,className:"gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Página ",o," de ",v]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>u(r=>Math.min(v,r+1)),disabled:o===v||s,className:"gap-2",children:["Próxima",e.jsx(ne,{className:"w-4 h-4"})]})]})]})]})})}export{Re as default};
